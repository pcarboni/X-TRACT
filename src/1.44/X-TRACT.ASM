TITLE XTRACT v1.44
		
		IDEAL
		MODEL SMALL
		STACK 0100H
		JUMPS
		CODESEG
MAIN:
		JMP XMAIN

EXEHEADORIG     DB 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
		DB 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
DTAPOINTERS     DB 00,00,00,00
POINTDTATEMP    DB 00,00,00,00
DTA             DB 80H DUP (0)
KEYREPPLY       DB 155 DUP (0)
BACKUPINT       DB 4*0100H DUP (0)
CANONICAL       DB 80h DUP (0)
HANDLE          DB 00,00
HANDLE2         DB 00,00
DATE            DB 00,00
TIME            DB 00,00
ATRIB           DB 00,00
BUFFER          DB 200H DUP (0)
OFFRUT4         DB 00,00
FILESIZECOM     DW 00 
TEMPAX          DW 00
TEMPBX          DW 00
TEMPCX          DW 00
TEMPDX          DW 00
TEMPDS          DW 00
TEMPES          DW 00
TEMPSI          DW 00
TEMPDI          DW 00
TEMPF           DW 00
OLDINT00        DW 00,00
INTF0IP         DB 00,00
INTF0CS         DB 00,00
INITSSSP        DB 00,00,00,00
PARAMBLOCK      DB 00,00 ; Copy caller's enviroment
		DB 80H,00
TAIL            DB 00,00 ; Command Tail Pointer ;-)
		DB 05CH,00
SEGFCB1         DB 00,00 ; 1st FCB Pointer
		DB 06CH,00
SEGFCB2         DB 00,00 ; 2nd FCB

CHILDSSSP       DB 00,00,00,00 ; Initial SS:SP
CHILDCSIP       DB 00,00,00,00 ; Initial CS:IP

POINT           DB 00,00
POINTS          DB 00
STARTNAME       DB 00,00
EXEHEADER       DB 020h DUP (0)
PID             DB 00,00
PID3            DB 00,00
DXLOW           DB 00,00
CXHIGH          DB 00,00
EXITINFO        DB 00
POINTIP         DB 00,00
POINTCS         DB 00,00
SIZEEXE1        DB 00,00
SIZEEXE2        DB 00,00
HIGHSIZE        DB 00,00
LOWSIZE         DB 00,00
RELOC           DB 00
EXEIP           DB 00,00
EXECS           DB 00,00
EXESS           DB 00,00
EXESP           DB 00,00
HEADHIGH        DB 00,00
HEADLOW         DB 00,00
REG             DB 00
REG148          DB 00
TYPEREG1        DB 00
REGVAL1         DB 00,00
TYPEREG2        DB 00
REGVAL2         DB 00,00
COUNTER148      DB 00
CODEPOINTER     DB 00,00
ACTIVO          DB 00
VALUEREG        DB 00,00
BREAKJZNZ       DB 00,00
NZNUMBA         DB 00
TEMPBYTE        DB 00,00
EXEMARK         DB 00
OVERLAY         DB 00
NOTFUCKINGDEL   DB 00
STATE21         DB 00
PKLITESHORTLONG DB 00
MSBLENGTH       DB 00,00
LSBLENGTH       DB 00,00
KEYTYPE         DB 00
FAKEPK          DB 00
PKTYPE          DB 00
CXPOS           DB 00,00
DXPOS           DB 00,00
ACTIVADO        DB 00
PARAES          DB 00,00
PARADI          DB 00,00
DATADI          DB 00,00
DATAES          DB 00,00
OFFSALTO        DB 00,00
RESERSEG        DB 00,00
RELOCAPPLY      DB 00
CANTRELOC       DB 00,00
OFFSETRELOC     DB 00,00
HEADFILL        DB 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
REGD            DB 00
SCRE2B          DB 00
HEADORIG        DB 00
ALLEXEMARKS     DB 00
EXITORCONT      DB 00
DSEGMENT        DB 00,00
ISJUMPINST      DB 00
LASTLOOP        DB 00
RETFLOOP        DB 00

TEMPPARAMETERS  DB 80h DUP (0)
LINEPARAMETERS  DB 80h DUP (0)

FAKEPKUPPER:
		DB 0C7H,006H,05CH,000H,050H,04BH,08CH,0D8H,005H,000H
		DB 000H,050H,0B8H,000H,000H,050H,0CBH
FAKEPKLOWER:
		DB 0C7H,006H,05CH,000H,070H,06BH,08CH,0D8H,005H,000H
		DB 000H,050H,0B8H,000H,000H,050H,0CBH
PRXCM4ID:
		DB 0E8H,000H,000H,05DH,081H,0EDH,013H,001H,033H,0C0H
		DB 08EH,0D8H,08BH,0F0H,0BFH,070H,000H,0B9H,008H,000H
		DB 0FCH,0F3H,0A5H,0FDH,087H,0FEH,08CH,0C0H,08EH,0D8H
		DB 033H,0C0H,08EH,0C0H,04FH,04FH,08BH,0C2H,0ABH,0B8H
		DB 0AEH,002H,003H,0C5H,0ABH,08BH,0C2H,0ABH,0B8H,0BBH
		DB 001H,003H,0C5H,0ABH,08BH,0C2H,0ABH,0E4H,021H,0A2H
		DB 06BH,000H,0B8H,0EFH,001H,003H,0C5H,0ABH,08BH,0C2H
		DB 0ABH,0B8H,0F8H,001H,003H,0C5H,0ABH,01EH,007H,0B0H
		DB 0FFH,0E9H,001H,000H,0C7H,0E6H,021H,0E9H,001H,000H
		DB 001H,0CCH
PRXCMID2:
		DB 08CH,0DBH,00EH,00EH,01FH,007H,0B9H
PRXCMID3:
		DB 0E8H,000H,000H,05EH,081H,0C6H,011H,000H,089H,0F7H
		DB 0ACH,034H
PRXCMID4:
		DB 0AAH,0E2H,0FAH
PRXCMID5:
		DB 08CH,0D0H,0A3H,06CH,000H,089H,026H,06EH,000H,0A1H
		DB 002H,000H,02DH,010H,000H,08CH,0CAH,0FAH,08EH,0D0H
		DB 0BCH,0FEH,000H,0FBH
BLOCKNOPS:
		DB 0FDH,08CH,0DBH,08CH,0CDH,08EH,0C5H,08EH,0DDH
RETORNO12:
		DB 050H,0BBH,012H,000H,053H,0CBH
SCRE2B102A:
		DB 08CH,0DAH,001H,016H,00CH,001H,0FFH,02EH,00AH,001H
SCRE2B102B:
		DB 083H,0C2H,010H,00EH,01FH,0BEH,093H,000H,0BFH,000H
		DB 001H,0B9H,00EH,000H,0F3H,0A4H,0ADH,08BH,0C8H,0E3H
		DB 00DH,0ADH,08BH,0D8H,0ADH,003H,0C2H,08EH,0C0H,026H
		DB 001H,017H,0E2H,0F3H,001H,016H,08BH,000H,001H,016H
		DB 091H,000H,083H,0EAH,010H,08EH,0C2H,0B4H,04AH,0BBH
		DB 0FFH,0FFH,0CDH,021H,073H,038H,081H,0FBH
SCRE2B102C:
		DB 073H,032H,00EH,01FH,0BAH,04CH,000H,0B4H,009H,0CDH
		DB 021H,0B8H,0FFH,04CH,0CDH
SCRE2B102D:
		DB 033H,0C0H,033H,0DBH,033H,0C9H,033H,0F6H,033H,0FFH
		DB 08EH,016H,08BH,000H,08BH,026H,08DH,000H,08EH,0DAH
		DB 033H,0D2H,02EH,0FFH,02EH,08FH,000H
PROTECT3XGEN:
		DB 050H,01EH,006H,00EH,055H,00EH,01FH,033H,0C0H,08EH
		DB 0C0H,0FAH,0FCH,026H,0A1H,004H,000H,050H,026H,0A1H
		DB 006H,000H,050H,026H,0A1H,00CH,000H,050H,026H,0A1H
		DB 00EH,000H,050H,08CH,0C8H,026H,0A3H,006H,000H,026H
		DB 0C7H,006H,004H,000H
PRXCM31EXEID:
		DB 02EH,0A3H,000H,000H,08CH,0D8H,02EH,0A3H,002H,000H
		DB 08CH,0C8H,02EH,0A3H,006H,000H,02EH,089H,02EH,004H
		DB 000H,033H,0C0H,08EH,0D8H,0FAH,0FCH,0BEH,004H,000H
		DB 00EH,007H,0BFH,008H,000H,0A5H,0A5H,0BEH,00CH,000H
		DB 0A5H,0A5H,01EH,007H,0BEH,004H,000H,0BFH,00CH,000H
		DB 0B8H,0D4H,001H,0ABH,087H,0FEH,0ABH,02EH,0A1H,006H
		DB 000H,087H,0FEH,0ABH,087H,0F7H,0ABH,089H,0E0H,08CH
		DB 0D3H,00EH,017H,0BCH,085H,000H,0B9H,0CDH,001H,04CH
		DB 04CH,089H,0C4H,08EH,0D3H,0FBH,0CDH,001H
PRXCM30EXEID:
		DB 02EH,0A3H,000H,000H,08CH,0D8H,02EH,0A3H,002H,000H
		DB 08CH,0C8H,02EH,0A3H,006H,000H,02EH,089H,02EH,004H
		DB 000H,033H,0C0H,08EH,0C0H,0FAH,0FCH,026H,0A1H,004H
		DB 000H,02EH,0A3H,00AH,000H,026H,0A1H,006H,000H,02EH
		DB 0A3H,008H,000H,026H,0A1H,00CH,000H,02EH,0A3H,00EH
		DB 000H,026H,0A1H,00EH,000H,02EH,0A3H,00CH,000H,02EH
		DB 0A1H,006H,000H,026H,0A3H,006H,000H,026H,0C7H,006H
		DB 004H,000H,0D4H,001H,026H,0A3H,00EH,000H,026H,0C7H
		DB 006H,00CH,000H,0D4H,001H,0FBH,0CDH,001H
PRXCM20COMID1:               
		DB 050H,0B8H,050H,001H,050H,0E9H,001H,000H
PRXCM20COMID2:
		DB 08CH,0C8H,08EH,0D8H,08EH,0C0H,0BEH,014H,001H,0B9H
		DB 050H,001H,029H,0F1H,089H,0F7H,0ACH,034H
PRXCM20EXEID:
		DB 01EH,006H,08CH,0C8H,08EH,0D8H,08EH,0C0H,0BEH,0A7H
		DB 000H,08BH,0FEH,0B9H,043H,000H,0ACH,034H,0FFH,0D0H
		DB 0C0H,0D0H,0C0H,0D0H,0C0H,0AAH,0E2H,0F4H,0BEH,003H
		DB 000H,08BH,0FEH,0B9H,0A7H,000H,02BH,0CFH,0ACH,0D0H
PRXCM1XCOMID1:
		DB 050H,0E9H,001H,000H
PRXCM1XCOMID2:
		DB 0FCH,0BFH,000H,001H,0BEH,03FH,001H,08CH,0C8H,08EH
		DB 0D8H,08EH,0C0H,0E9H,001H,000H
PRXCM11EXEID:
		DB 01EH,006H,08CH,0C8H,08EH,0D8H,08EH,0C0H,02EH,0C6H
		DB 006H,003H,000H,090H,0C6H,006H,01FH,000H,090H,02EH
		DB 0C6H,006H,044H,000H,090H,0C6H,006H,060H,000H,090H
		DB 0C6H,006H,055H,000H,090H,0BEH,08BH,000H,08BH,0FEH
PRXCM10EXEID:
		DB 01EH,006H,08CH,0C8H,08EH,0D8H,08EH,0C0H,02EH,0C6H
		DB 006H,003H,000H,090H,02EH,0C6H,006H,01FH,000H,090H
		DB 02EH,0C6H,006H,044H,000H,090H,02EH,0C6H,006H,060H
		DB 000H,090H,02EH,0C6H,006H,055H,000H,090H,0BEH,08BH
		DB 000H,08BH,0FEH
LZEXE091ID:                
		DB 08BH,0C3H,08BH,03EH,004H,000H,08BH,036H,006H,000H
		DB 001H,0C6H,001H,006H,002H,000H,02DH,010H,000H,08EH
		DB 0D8H,08EH,0C0H,031H,0DBH,0FAH,08EH,0D6H,08BH,0E7H
		DB 0FBH,02EH,0FFH,02FH
LZEXE090ID:
		DB 006H,00EH,01FH,08BH,00EH,00CH,000H,08BH,0F1H,04EH
		DB 089H,0F7H,08CH,0DBH,003H,01EH,00AH,000H,08EH,0C3H
		DB 0B4H,000H,031H,0EDH,0FDH,0ACH,001H,0C5H,0AAH,0E2H
		DB 0FAH,08BH,016H,00EH,000H,08AH,0C2H,029H,0C5H,08AH
		DB 0C6H,029H,0C5H,039H,0D5H,074H,00CH
CRUNCH11ID1:
		DB 0BEH,003H,001H,0B3H
CRUNCH11ID2:
		DB 02EH,030H,01CH,046H,0E2H,0FAH,0C7H,006H,000H,001H
CRUNCH11ID3:
		DB 0C6H,006H,002H,001H
CRUNCH11ID4:
		DB 0BEH,000H,001H,056H,0C3H
CRUNCH12ID1:
		DB 0B8H,011H,009H,0BEH,047H,046H,0BFH,04DH,04AH,0BAH
CRUNCH12ID2:
		DB 0BEH,003H,001H,0B3H
CRUNCH12ID3:
		DB 02EH,030H,01CH,046H,0E2H,0FAH,0C7H,006H,000H,001H
CRUNCH12ID4:
		DB 0C6H,006H,002H,001H
CRUNCH12ID5:
		DB 0BEH,000H,001H,056H,0C3H
CRUNCH13ID1:
		DB 0B8H,011H,009H,0BEH,047H,046H,0BFH,04DH,04AH,0BAH
CRUNCH13ID2:
		DB 0BEH,003H,001H,0BBH
CRUNCH13ID3:
		DB 02EH,031H,004H,046H,0F7H,0E3H,0E2H,0F8H,0C7H,006H
		DB 000H,001H
CRUNCH13ID4:
		DB 0C6H,006H,002H,001H
CRUNCH13ID5:
		DB 0BEH,000H,001H,056H,0C3H
BLIZTID1:
		DB 0BEH,003H,001H,0B3H,03FH,0BBH,090H,000H,0B0H,010H
		DB 0BAH,020H,000H,0B9H
BLIZTID2:
		DB 02EH,030H,01CH,02EH,031H,01CH,02EH,030H,004H,02EH
		DB 031H,014H,046H,0E2H,0F1H,0C7H,006H,000H,001H
PKLITE115COMID:
		DB 03BH,0C4H,073H,069H,08BH,0C4H,02DH,044H,003H,090H
		DB 025H,0F0H,0FFH,08BH,0F8H,0B9H,0A2H,000H,090H,0BEH
		DB 07EH,001H,0FCH,0F3H,0A5H,08BH,0D8H,0B1H,004H,0D3H
		DB 0EBH,08CH,0D9H,003H,0D9H,053H,033H,0DBH,053H,0CBH
PKLITE115EXEID1:
		DB 02DH,020H,000H,08EH,0D0H,02DH
PKLITE115EXEID2:
		DB 090H,08EH,0C0H,050H,0B9H
PKLITE115EXEID3:
		DB 033H,0FFH,057H,0BEH,044H,001H,0FCH,0F3H,0A5H,0CBH
PKLITE115XTRAID1:
		DB 02Dh,020h,000h,08Eh,0D0h,02Dh,01Ah,000h,050h,052h
		DB 0B9H,0D9H,000H,0BEH,0F6H,002H,08BH,0FEH,0FDH,090H
		DB 049H,074H,007H,0ADH,092H,033H,0C2H,0ABH,0EBH,0F6H
PKLITE115XTRAID2:
		DB 02Dh,020h,000h,08Eh,0D0h,02Dh,026h,000h,050h,052h
		DB 0B9H,037H,001H,0BEH,0B2H,003H,08BH,0FEH,0FDH,090H
		DB 049H,074H,007H,0ADH,092H,033H,0C2H,0ABH,0EBH,0F6H
PKLITE114XTRAID1:
		DB 02Dh,020h,000h,08Eh,0D0h,02Dh,01Ah,000h,050h,052h
		DB 0B9H,0D7H,000H,0BEH,0F2H,002H,08BH,0FEH,0FDH,090H
		DB 049H,074H,007H,0ADH,092H,033H,0C2H,0ABH,0EBH,0F6H
PKLITE114XTRAID2:
		DB 02Dh,020h,000h,08Eh,0D0h,02Dh,026h,000h,050h,052h
		DB 0B9H,036H,001H,0BEH,0B0H,003H,08BH,0FEH,0FDH,090H
		DB 049H,074H,007H,0ADH,092H,033H,0C2H,0ABH,0EBH,0F6H
PKLITE120XTRAID1:
		DB 08BH,0FCH,081H,0EFH,04CH,003H,057H,057H,052H,0B9H
		DB 0AEH,000H,0BEH,09EH,002H,08BH,0FEH,0FDH,049H,074H
		DB 007H,0ADH,092H,003H,0C2H,0ABH,0EBH,0F6H
PKLITE120XTRAID2:
		DB 08BH,0FCH,081H,0EFH,04AH,003H,057H,057H,052H,0B9H
		DB 0ADH,000H,0BEH,09CH,002H,08BH,0FEH,0FDH,049H,074H
		DB 007H,0ADH,092H,003H,0C2H,0ABH,0EBH,0F6H
PKLITE120XTRAID3:
		DB 02DH,020H,000H,0FAH,08EH,0D0H,0BCH,000H,002H,0FBH
		DB 02DH,022H,000H,050H,052H,0B9H,012H,001H,0BEH,070H
		DB 003H,08BH,0FEH,01EH,007H,0FDH,049H,074H,007H,0ADH
		DB 092H,003H,0C2H,0ABH,0EBH,0F6H
EXEHEAD:
		DB 04DH,05AH,000H,000H,000H,000H,000H,000H,002H,000H
		DB 000H,000H,0FFH,0FFH,000H,000H,000H,000H,000H,000H
		DB 000H,000H,000H,000H,01CH,000H,000H,000H
		DB 000H,000H,000H,000H
KEYID:
		DB   84,104,105,115, 32,105,115, 32,121,111
		DB  117,114, 32,114,101,103,105,115,116,114
		DB   97,116,105,111,110, 32,107,101,121, 32  
		DB  102,111,114, 32, 88, 45, 84, 82, 65, 67 
		DB   84, 46, 32, 80,108,101, 97,115,101, 44 
		DB   32,100,111, 32,110,111,116, 32,100,105
		DB  115,116,114,105, 98,117,116,101, 32,105
		DB  116, 33, 13, 10, 40, 99, 41, 32, 49, 57
		DB   57, 52, 32, 98,121, 32, 87,111,111,100
		DB  121, 44, 32, 66,117,101,110,111,115, 32
		DB   65,105,114,101,115, 44, 32, 65, 82, 71
		DB   69, 78, 84, 73, 78, 65, 46, 32, 80, 97
		DB  98, 108, 111, 32, 76, 105, 118, 101
		DB  115, 32, 83, 111, 109, 101, 119, 104
		DB  101, 114, 101, 32, 73, 110, 32, 84
		DB  104, 101, 32, 84, 105, 109, 101, 46
		DB  13, 10
TEMPNAME:
		DB '$$XTRAC$.$$$',00h
KEYNAME:                                                                                        
		DB 'X-TRACT.KEY',00h
BYTEREGISTERED:
		DB 00
INTROTITLE:
		DB 'X-TRACT (tm)   Executable File Extractor  Version 1.44  11-27-94',0dh,0ah
		DB 'Copyright 1994 by Woody.  All Rights Reserved.','$'
REGISTERED:
		DB '  REGISTERED VERSION'
		DB 0DH,0AH,'$'
BETA:
		DB '  BETA-TEST VERSION'
		DB 0DH,0AH,'$'
DISTROSITE:
		DB '  DISTR. SITE VERSION'
		DB 0DH,0AH,'$'

NOPATENT:                
		DB '   No patent ;-('
		DB 0DH,0AH,'$'

HELPTEXT:
		DB 0dh,0ah,'Usage: X-TRACT [d:][/path]filename.ext',0dh,0ah,0ah,'$'
HELPNOPATENT:                
		DB 'This program is freeware, please spread it FREELY'
		db 0dh,0ah,'$'
HELPWITHKEY:                
		DB 'This copy is registered to: ','$'
NOFOUND:
		DB 0dh,0ah,'Could not find the file!',0dH,0aH,'$'
NAMEFILE:
		DB 0dh,0ah,'Opening : ','$'
FOUNDPRG:
		DB 0dh,0ah,'Found '
		DB '$'
PRXCM4OK:
		DB 'PROTECT! EXE/COM v4.0 (COM)'
		DB '$'
PRXCM4EXEOK:
		DB 'PROTECT! EXE/COM v4.0 (EXE)'
		DB '$'
PROTECT5COMOK:
		DB 'PROTECT! EXE/COM v5.0 (COM)'
		DB '$'
PROTECT5EXEOK:
		DB 'PROTECT! EXE/COM v5.0, Unreg',039,'d version (EXE)'
		DB '$'
PROTECT5REGDEXEOK:
		DB 'PROTECT! EXE/COM v5.0, Reg',039,'d version (EXE)'
		DB '$'
SCRE2B102OK:
		DB 'SCRE2B v1.02 (COM)'
		DB '$'
PRXCM31COM:
		DB 'PROTECT! EXE/COM v3.1 (COM)'
		DB '$'
PRXCM30COM:
		DB 'PROTECT! EXE/COM v3.0 (COM)'
		DB '$'
PRXCM31EXE:
		DB 'PROTECT! EXE/COM v3.1 (EXE)'
		DB '$'
PRXCM30EXE:
		DB 'PROTECT! EXE/COM v3.0 (EXE)'
		DB '$'
PRXCM20COM:
		DB 'PROTECT! EXE/COM v2.0 (COM)'
		DB '$'
PRXCM20EXE:
		DB 'PROTECT! EXE/COM v2.0 (EXE)'
		DB '$'
PRXCM1XCOM:
		DB 'PROTECT! EXE/COM v1.0 or v1.1 (COM)'
		DB '$'
PRXCM11EXE:
		DB 'PROTECT! EXE/COM v1.1 (EXE)'
		DB '$'
PRXCM10EXE:
		DB 'PROTECT! EXE/COM v1.0 (EXE)'
		DB '$'
LZEXE091:
		DB 'LZEXE v0.91 or v1.00a (EXE)'
		DB '$'
LZEXE090:
		DB 'LZEXE v0.90 (EXE)'
		DB '$'
CRUNCH11:
		DB 'CRUNCH v1.1 (COM)'
		DB '$'
CRUNCH12:
		DB 'CRUNCH v1.2 (COM)'
		DB '$'
CRUNCH13:
		DB 'CRUNCH v1.3 (COM)'
		DB '$'
BLIZT10B:
		DB 'BLIZT v1.0b (COM)'
		DB '$'
PKLITE115COM:
		DB 'PKLITE v1.15 (COM)'
		DB '$'
PKLITE115EXE:
		DB 'PKLITE v1.15 (EXE)'
		DB '$'
PKLITE115XTRA:
		DB 'PKLITE v1.15, extra! (EXE)'
		DB '$'
PKLITE114XTRA:
		DB 'PKLITE v1.14, extra! (EXE)'
		DB '$'
PKLITE120XTRA:
		DB 'PKLITE v1.20, extra! (EXE)'
		DB '$'
NOTOUCHED:
		DB 0Dh,0ah,'No known program found!',0dh,0ah,'$'
NOTMEMO:
		DB 0dh,0ah,'Not enough memory - Remove some TSR',27H,'s & '
		DB 'Try Again!',0dh,0ah,'$'
FUCKED:
		DB 0dH,0aH,'Saving file ...$'
DONE:
		DB ' done ! ...',0dh,0ah,'$'
REMOVE:
		DB ', remove? [Y/N] $'
OVERLAYMSG:
		DB 0dh,0ah,'Overlays detected in $'
COPYMSG:
		DB '!, copy? [Y/N] $'
CARRIAGE:
		DB 0dh,0ah,'$'
FAKEXTR141520:
		DB 0dh,0ah,'Do you want to fake PKLITE signature? [Y/N] $'

XMAIN:
		IN AL,21H
		MOV [BYTE CS:STATE21],AL
		PUSHF
		CALL INTRO
		CLC
		MOV AH,62H
		INT 21H
		MOV ES,BX
		CMP [BYTE ES:0080H],02
		JNB READCOMMANDLINE
SHELP:
		JMP HELP
READCOMMANDLINE:
		CMP [BYTE ES:0081H],20H
		JNE SHELP
		XOR CH,CH
		MOV CL,[BYTE ES:0080H]
		MOV SI,0081H
		MOV BX,CX
		MOV [BYTE ES:BX+SI],00
		MOV DI,OFFSET LINEPARAMETERS
		CLD
		PUSH ES
		POP DS
		PUSH CS
		POP ES
		REP MOVSB
COMMANDLINE:
		MOV BX,OFFSET LINEPARAMETERS
		INC BX
		XOR SI,SI
CHECKPOINT:
		MOV AL,[BYTE ES:BX+SI]
		CMP AL,"."
		JE PUTPOINT
		CMP AL,00H
		JE EXTENSION
		INC SI
		JMP CHECKPOINT
PUTPOINT:
		ADD BX,SI
		MOV [WORD ES:POINT],BX
		SUB BX,SI
		INC SI
		INC [WORD ES:POINTS]
		JMP CHECKPOINT

EXTENSION:
		CMP [WORD ES:POINTS],0000H
		JNE EXT2
		ADD BX,SI
		MOV [WORD ES:POINT],BX
EXT2:           
		ADD BX,SI
		SUB BX,0002H
		XOR SI,SI
CONT2:
		MOV AL,[BYTE ES:BX+SI]
		CMP AL," "
		JE FOUNDNAME
		DEC BX
		JMP CONT2
FOUNDNAME:
		XCHG BX,SI
		ADD BX,SI
		INC BX
		MOV [WORD ES:STARTNAME],BX
		MOV CX,[WORD ES:POINT]
		ADD CX,0004H
		SUB CX,[WORD ES:STARTNAME]
		CLD
		MOV SI,[WORD ES:STARTNAME]
		MOV DI,OFFSET LINEPARAMETERS
		PUSH CS
		POP DS
		REP MOVSB
		MOV AL,0H
		STOSB

SHOWFILENAME:
		MOV AH,60H
		MOV SI,OFFSET LINEPARAMETERS
		MOV DI,OFFSET CANONICAL
		INT 21H
		
		MOV AH,2FH
		INT 21H
		MOV [WORD CS:DTAPOINTERS],BX
		MOV [WORD CS:DTAPOINTERS+2],ES
		
		MOV AH,1AH
		MOV DX,OFFSET DTA
		PUSH CS
		POP DS
		INT 21H


		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET CANONICAL
		INT 21H
		
		JNC  OK
		JMP MSGERR
OK:             
		MOV DX,OFFSET NAMEFILE
		CALL PRINT
		
		MOV BX,OFFSET DTA+1EH
		XOR SI,SI

FILE:
		MOV DL,[BYTE BX+SI]          
		CMP DL,00
		JZ CHECK
		MOV AH,02
		INT 21H
		INC SI
		JMP FILE                

CHECK:
		MOV BX,OFFSET CANONICAL
		DEC BX
		XOR SI,SI
COPYPATH:
		INC SI
		MOV AL,[BYTE BX+SI]
		CMP AL,0000H
		JNZ COPYPATH
SCANSLASH:              
		DEC SI
		MOV AL,[BX+SI]
		CMP AL,005CH
		JZ STOREPATH
		JMP SCANSLASH

STOREPATH:              
		ADD BX,SI
		SUB BX,OFFSET CANONICAL-0001H
		MOV CX,BX
		CLD
		MOV SI,OFFSET CANONICAL
		MOV DI,OFFSET LINEPARAMETERS
		PUSH CS
		POP ES
		REP MOVSB

		XOR BX,BX
		MOV SI,OFFSET DTA+1EH
COPYFILENAME:
		MOV AL,[BX+SI]
		CMP AL,00
		JZ OPENFILE
		MOV [BX+DI],AL
		INC BX
		JMP COPYFILENAME
		
		MOV [BX+DI],AL
		INC BX
		JMP COPYPATH

OPENFILE:
		MOV [BX+DI],AL
		
		MOV DX,OFFSET CARRIAGE
		CALL PRINT
FINDINGPATH:
		STD
		MOV CX,0080H
		PUSH CS
		POP ES
		MOV DI,OFFSET LINEPARAMETERS+007FH
		MOV AL,'\'
		REPNZ SCASB
		INC CX

		PUSH CS
		POP DS
		MOV SI,OFFSET LINEPARAMETERS
		MOV DI,OFFSET TEMPPARAMETERS
		CLD
		REP MOVSB
		MOV SI,OFFSET TEMPNAME
		MOV CX,000DH
		REP MOVSB




OPENFILE2:                
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID3],BX
		MOV ES,BX

		MOV [WORD CS:TAIL],ES
		MOV [WORD CS:SEGFCB1],ES
		MOV [WORD CS:SEGFCB2],ES

		MOV AX,ES
		MOV BX,XT
		SUB BX,AX
		
		MOV AH,4AH
		INT 21H

		MOV BX,[WORD ES:002CH]
		MOV [WORD CS:PARAMBLOCK],BX
		PUSH CS
		POP DS
		PUSH CS
		POP ES
		MOV AX,4B01H
		MOV BX,OFFSET PARAMBLOCK
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		PUSHF
		INC [BYTE CS:EXITINFO]
		CMP [BYTE CS:EXITINFO],02
		JZ FIN
		POPF
		JNC CHECKPRXCMCOM
		
		MOV DX,OFFSET NOTMEMO
		CALL PRINT
		MOV [BYTE CS:NOTFUCKINGDEL],01H
		JMP FIN1                
		
CHECKPRXCMCOM:  
		XOR BX,BX
		MOV SI,[WORD CS:CHILDCSIP]
		MOV DS,[WORD CS:CHILDCSIP+02]

		MOV AL,[BX+SI]
		
CHECK4JUMP:                
		CMP AL,0B8H
		JE CHECKPKLITE115COM

		CMP AL,0E9H
		JE CHECK4ALL

		CMP AL,0E8H
		JNE CHECKPRXCM31EXE
CHECK4ALL:
		CMP SI,0000H
		JZ CHECKPRXCM20EXE

		MOV DX,[BX+SI+1]
		ADD DX,0103H
		MOV [WORD CS:OFFSALTO],DX
		MOV SI,DX

		PUSH CS
		POP ES
		MOV DI,OFFSET PRXCM4ID
		MOV CX,0092
		CLD
		REP CMPSB
		JNZ CHECKBLIZT10B
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM4OK
		CALL PRINT
		CALL PAGK

		JMP UNPRXCM4 ; 8-)
		
FIN1:           

SHOWIFOVERLAY:
		MOV AL,[BYTE CS:STATE21]
		OUT 21H,AL
		CMP [BYTE CS:OVERLAY],01H
		JNE READYTODEL
		CALL SHOWOVERLAY
READYTODEL:
		CMP [BYTE CS:NOTFUCKINGDEL],01H
		JE PUTDONE
		PUSH CS
		POP DS
		MOV AH,09H
		MOV DX,OFFSET FUCKED
		INT 21H
		
		PUSH CS
		POP DS
		MOV AH,41H
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		PUSH CS
		POP ES
		MOV AH,56H
		MOV DX,OFFSET TEMPPARAMETERS
		MOV DI,OFFSET LINEPARAMETERS
		INT 21H
		
		MOV AH,09H
		PUSH CS
		POP DS
		MOV DX,OFFSET DONE
		INT 21H

PUTDONE:               
		MOV [BYTE CS:EXITORCONT],01H
FIN2:                
		CALL DTANORMAL
		MOV AX,4C00H
		INT 21H
FIN:
		CMP [BYTE CS:EXITORCONT],01H
		JE RETRYCHECK
		MOV AX,4C00H
		INT 21H

RETRYCHECK:
		MOV [BYTE CS:EXITINFO],00H
		MOV [BYTE CS:EXITORCONT],00H
		MOV [BYTE CS:EXEMARK],00H
		PUSH CS
		POP ES
		MOV DI,OFFSET INITSSSP
		MOV SI,OFFSET EXEHEADORIG
		SUB DI,SI
		MOV CX,DI
		XOR AX,AX
		XCHG SI,DI
		CLD
		REP STOSB
		MOV DI,OFFSET RETFLOOP
		MOV SI,OFFSET CHILDSSSP
		SUB DI,SI
		MOV CX,DI
		XOR AX,AX
		XCHG SI,DI
		CLD
		REP STOSB


		JMP OPENFILE2
SHOWOVERLAY:
		MOV DX,OFFSET OVERLAYMSG
		CALL PRINT
		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		LDS DX,[DWORD CS:POINTDTATEMP]
		MOV BX,DX
		ADD BX,001EH
		XOR SI,SI

FILEZ:
		MOV DL,[BYTE BX+SI]          
		CMP DL,00
		JZ ENDFILEZ
		MOV AH,02
		INT 21H
		INC SI
		JMP FILEZ                
ENDFILEZ:                
		MOV DX,OFFSET COPYMSG
		CALL PRINT

PAGK2:           ; Press And Get Key 2 :)
		
GETKEY2:
		MOV AH,08H
		INT 21H
		CMP AL,79H
		JE LETCONT2
		CMP AL,59H
		JE LETCONT2
		CMP AL,4EH
		JE DONTCONT2
		CMP AL,6EH
		JE DONTCONT2
		JMP GETKEY2
DONTCONT2:                
		CALL PRINTCHAR
		RETN
LETCONT2:
		CALL PRINTCHAR

		MOV AH,62H
		INT 21H
		MOV ES,BX

		MOV AH,49h
		INT 21H

		MOV ES,[WORD CS:PID3]

		MOV AX,ES
		MOV BX,XT
		SUB BX,AX
		
		MOV AH,4AH
		INT 21H
		
		MOV AH,48H
		MOV BX,0500H
		INT 21H

		JNC MEMOOK
		
		MOV DX,OFFSET NOTMEMO
		CALL PRINT

		MOV AX,4301H
		MOV DX,OFFSET TEMPPARAMETERS
		XOR CX,CX
		INT 21H
		
		
		MOV AH,41H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV AX,3D02H
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX
		
		MOV BX,[WORD CS:HANDLE]
		MOV AX,5701H
		MOV CX,[WORD CS:TIME]
		MOV DX,[WORD CS:DATE]
		INT 21H
		MOV AH,3EH
		INT 21H
		MOV AX,4301H
		MOV DX,OFFSET LINEPARAMETERS
		MOV CX,[WORD CS:ATRIB]
		INT 21H
		
		
		MOV [BYTE CS:EXITORCONT],00H
		POP AX
		MOV AX,OFFSET FIN2
		PUSH AX
		RET

MEMOOK:
		MOV [WORD CS:RESERSEG],AX
		
		MOV AX,4301H
		MOV DX,OFFSET TEMPPARAMETERS
		XOR CX,CX
		INT 21H

		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX                

		MOV AX,3D00H
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE2],AX

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H

		MOV AX,4200H
		MOV BX,[WORD CS:HANDLE2]
		MOV CX,[WORD CS:CXHIGH]
		MOV DX,[WORD CS:DXLOW]
		INT 21H
READONCEAGAIN:
		MOV AH,3FH
		MOV BX,[WORD CS:HANDLE2]
		MOV CX,4000H
		MOV DS,[WORD CS:RESERSEG]
		MOV DX,0100H
		INT 21H

		CMP AX,4000H
		JB WRITELASTBLOCK

		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,4000H
		MOV DS,[WORD CS:RESERSEG]
		MOV DX,0100H
		INT 21H

		JMP READONCEAGAIN



WRITELASTBLOCK:
		MOV CX,AX
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV DS,[WORD CS:RESERSEG]
		MOV DX,0100H
		INT 21H

		
		MOV BX,[WORD CS:HANDLE]
		MOV AX,5701H
		MOV CX,[WORD CS:TIME]
		MOV DX,[WORD CS:DATE]
		INT 21H
		
		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE2]
		INT 21H
		
		PUSH CS
		POP DS
		MOV AX,4301H
		MOV DX,OFFSET TEMPPARAMETERS
		MOV CX,[WORD CS:ATRIB]
		INT 21H
		
		MOV AH,49H
		MOV ES,[WORD CS:RESERSEG]
		INT 21H
		RETN                
		
		
		
		
		
		
		
		RET

CHECKEXE:
		JMP CHECKPRXCMEXE
CHECKPROTECT5COM:
CHECKSUBADDXOR:
		MOV SI,DX
BIROUTINE:
		MOV AL,[BYTE DS:SI]
		CMP AL,0B8H
		JZ CHECKERROR
		CMP [BYTE DS:SI+0003H],81H
		JNZ CHECKROTATE
		MOV [WORD CS:CODEPOINTER],SI
		ADD [WORD CS:CODEPOINTER],07H
		MOV BL,[BYTE DS:SI+0004H]
		SUB BL,AL
		CMP BL,30H
		JZ SUBOK
		CMP BL,08H
		JZ ADDOK
		CMP BL,38H
		JZ XOROK
		JMP CHECKERROR  
		

SUBOK:
		MOV AX,[WORD DS:SI+0001H]
		MOV BX,[WORD DS:SI+0005H]
		SUB AX,BX
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS
		CMP AX,0148H
		JZ INTERPRETAR
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER
ADDOK:
		MOV AX,[WORD DS:SI+0001]
		MOV BX,[WORD DS:SI+0005]
		ADD AX,BX
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS
		CMP AX,0148H
		JZ INTERPRETAR
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER
XOROK:
		MOV AX,[WORD DS:SI+0001]
		MOV BX,[WORD DS:SI+0005]
		XOR AX,BX
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS
		CMP AX,0148H
		JZ INTERPRETAR
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER
EXECUENTAS:
		MOV [WORD CS:REGVAL1],AX
		MOV AL,[BYTE DS:SI]
		MOV [BYTE CS:TYPEREG1],AL
		JMP UNDERSTAND

CHECKROTATE:
CHECKROLROR:
		CMP [BYTE DS:SI+0003H],0D1H
		JNZ CHECKERROR
		MOV [WORD CS:CODEPOINTER],SI
		ADD [WORD CS:CODEPOINTER],05H
		MOV BL,[BYTE DS:SI+0004H]
		SUB BL,AL
		CMP BL,08H
		JZ ROLOK
		CMP BL,10H
		JZ ROROK
		JMP CHECKERROR
ROLOK:
		MOV AX,[WORD DS:SI+0001H]
		ROL AX,1
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS
		
		CMP AX,0148H
		JZ INTERPRETAR
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER
ROROK:  
		MOV AX,[WORD DS:SI+0001H]
		ROR AX,1
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS
		
		CMP AX,0148H
		JZ INTERPRETAR
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER

CHECKERROR:     MOV DX,OFFSET NOTOUCHED
		CALL PRINT
		CALL DTANORMAL

		JMP FIN
PUTREGISTER:
		MOV AL,[BYTE DS:SI]
		AND AL,07H
		MOV [BYTE CS:REG],AL            
		MOV [BYTE CS:COUNTER148],01H
		JMP UNDERSTAND
INTERPRETAR:            
		MOV AL,[BYTE DS:SI]
		AND AL,07H
		MOV [BYTE CS:REG148],AL
UNDERSTAND:
		MOV SI,[WORD CS:CODEPOINTER]
VEREMOS:
		XOR DI,DI
		MOV BX,OFFSET INSTLIBR1-1

		JMP SEEINST
INSTLIBR1:
		DB 0BBH,0B9H,0BAH,0BEH,0BFH,0BDH,000H
INAL21LIB:
		DB 050H,0E4H,021H,050H,0E9H,00EH,000H
OUT21LIB1:
		DB 0E6H,021H,0E9H,001H,000H
OUT21LIB2:
		DB 058H,0E6H,021H,0E9H,006H,000H
SEEINST:
		
ESMOV:
		MOV AL,[BYTE DS:SI]

REPETIR:                
		INC DI
		MOV CL,[BYTE CS:BX+DI]
		OR CL,CL
		JZ ESJUMP
		CMP CL,AL
		JNZ REPETIR

VEAMOS:
		JMP SEE2NDREG ; A VER EL 2DO REGISTRO
ESJUMP:
		CMP AL,0EBH
		JNZ OUT21LIB
		MOV AL,[BYTE DS:SI+01H]
		CMP AL,80H
		JAE RETRO
AVANCE:
		XOR AH,AH
		ADD SI,AX
		ADD SI,0002H
		JMP VEREMOS
RETRO:
		NEG AL
		XOR AH,AH
		SUB SI,AX
		ADD SI,0002H
		JMP VEREMOS
OUT21LIB:
		PUSH SI
		PUSH DI
		MOV DI,OFFSET OUT21LIB1
		MOV CX,0005H
		CLD
		REP CMPSB
		JNZ OUT21LIBTWO
		POP DI
		POP SI
		ADD SI,0006H
		JMP VEREMOS
OUT21LIBTWO:
		POP DI
		POP SI
		PUSH SI
		PUSH DI
		MOV DI,OFFSET OUT21LIB2
		MOV CX,0006H
		CLD
		REP CMPSB
		JNZ MOVALFF
		POP DI
		POP SI
		ADD SI,000CH
		JMP VEREMOS
MOVALFF:
		POP DI
		POP SI
		CMP AL,0B0H
		JNZ CHECKINAL21
		CMP [BYTE DS:SI+01H],0FFH
		JNZ CHECKERROR
		ADD SI,0002H
		JMP VEREMOS
CHECKINAL21:
		PUSH SI
		PUSH DI
		MOV DI,OFFSET INAL21LIB
		MOV CX,0007H
		CLD
		REP CMPSB
		JNZ CHECKPOPAXONLY
		POP DI
		POP SI
		ADD SI,0015H
		JMP VEREMOS

CHECKPOPAXONLY:
		POP DI
		POP SI
		CMP AL,058H
		JNZ CHECKINDEXED
		ADD SI,0001H
		JMP VEREMOS
SEE2NDREG:
CHECKSUBADDXOR2:
		CMP AL,0B8H
		JZ CHECKERROR
		CMP [BYTE DS:SI+0003H],81H
		JNZ CHECKROTATE22
		MOV BL,[BYTE DS:SI+0004H]
		SUB BL,AL
		CMP BL,30H
		JZ SUBOK2
		CMP BL,08H
		JZ ADDOK2
		CMP BL,38H
		JZ XOROK2
		JMP CHECKERROR  
		
SUBOK2:
		MOV AX,[WORD DS:SI+0001H]
		MOV BX,[WORD DS:SI+0005H]
		SUB AX,BX
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS2
		CMP AX,0148H
		JZ PUTREGISTER31
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER31
ADDOK2:
		MOV AX,[WORD DS:SI+0001]
		MOV BX,[WORD DS:SI+0005]
		ADD AX,BX
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS2
		CMP AX,0148H
		JZ PUTREGISTER31
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER31
XOROK2:
		MOV AX,[WORD DS:SI+0001]
		MOV BX,[WORD DS:SI+0005]
		XOR AX,BX
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS2
		CMP AX,0148H
		JZ PUTREGISTER31
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER31

CHECKROTATE22:
CHECKROLROR2:
		CMP [BYTE DS:SI+0003H],0D1H
		JNZ CHECKERROR
		MOV BL,[BYTE DS:SI+0004H]
		SUB BL,AL
		CMP BL,08H
		JZ ROLOK2
		CMP BL,10H
		JZ ROROK2
		JMP CHECKERROR
ROLOK2:
		MOV AX,[WORD DS:SI+0001H]
		ROL AX,1
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS2
		CMP AX,0148H
		JZ PUTREGISTER22
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER22
ROROK2:  
		MOV AX,[WORD DS:SI+0001H]
		ROR AX,1
		CMP [BYTE CS:EXEMARK],01H
		JZ EXECUENTAS2
		CMP AX,0148H
		JZ PUTREGISTER22
		MOV [WORD CS:VALUEREG],AX
		JMP PUTREGISTER22
EXECUENTAS2:
		MOV [WORD CS:REGVAL2],AX
		MOV AL,[BYTE DS:SI]
		MOV [BYTE CS:TYPEREG2],AL
		CMP [BYTE DS:SI+0003H],0D1H
		JZ PUTREGISTER22
		
PUTREGISTER31:
		ADD SI,0007H
		JMP PUTREGISTER3

PUTREGISTER22:
		ADD SI,0005H
PUTREGISTER3:
		CMP [BYTE CS:COUNTER148],01H
		JNZ NOPUT148REG ; Pone el registro que no es 148h
		MOV AL,[BYTE DS:SI]
		AND AL,07H
		MOV [BYTE CS:REG148],AL
		JMP SEARCHINDEXED
NOPUT148REG:
		MOV AL,[BYTE DS:SI]
		AND AL,07H
		MOV [BYTE CS:REG],AL
SEARCHINDEXED:
		MOV [BYTE CS:ACTIVO],01H
		JMP VEREMOS
CHECKINDEXED:
		CMP [BYTE CS:ACTIVO],01H
		JNZ CHECKERROR
		MOV AL,[BYTE DS:SI]
		CMP AL,08BH
		JE CHECKINDEXEDMOV
		CMP AL,087H
		JE CHECKINDEXEDMOV
		JMP CHECKERROR
CHECKINDEXEDMOV:
		MOV AH,[BYTE DS:SI+0001H]
		CMP AH,04H
		JE CHECKINDSIDIBX
		CMP AH,05H
		JE CHECKINDSIDIBX
		CMP AH,07H
		JE CHECKINDSIDIBX
		CMP AH,084H
		JE CHECKINDNUMBA
		CMP AH,085H
		JE CHECKINDNUMBA
		CMP AH,087H
		JE CHECKINDNUMBA
		JMP CHECKERROR
CHECKINDSIDIBX:
		ADD SI,0002H
SEEINDEX:               
		MOV BX,[SI]
		CMP BL,089H
		JE CHECKIFSIDIBX
		CMP BL,087H
		JE CHECKIFSIDIBX
		INC SI
		JMP SEEINDEX
CHECKIFSIDIBX:
		CMP BH,AH
		JE FOUNDOK ; Por fin!!!!!!!!!!!!!
		INC SI
		JMP SEEINDEX
CHECKINDNUMBA:
		ADD SI,0002H
		MOV BX,[SI]
SEEINDEX2:
		ADD SI,0002H
SEEIND:
		MOV CX,[SI]
		CMP CL,089H
		JE CHECKIFSIDIBXINDEX
		CMP CL,087H
		JE CHECKIFSIDIBXINDEX
		INC SI
		JMP SEEIND
CHECKIFSIDIBXINDEX:
		CMP CH,AH
		JE CONTFIND
		INC SI
		JMP SEEIND
CONTFIND:
		MOV DX,[SI+0002H]
		CMP DX,BX
		JE FOUNDOK2
		INC SI
		JMP SEEIND
FOUNDOK2:
		CMP [BYTE EXEMARK],01H
		JZ SEEIFSIDIBXINDNUMBA
		ADD [WORD CS:VALUEREG],DX
FOUNDOK:
		CMP [BYTE EXEMARK],01H
		JZ SEEIFSIDIBXIND
OHYES:                
		MOV SI,[WORD CS:VALUEREG]
CHECKJZNZ:
		MOV AL,[BYTE DS:SI-0002H]
		CMP AL,075H
		JE PUTJNZBREAK ; :-)
		CMP AL,0EBH
		JE CHECKJZ
		JMP CHECKERROR
CHECKJZ:
		MOV AX,[WORD DS:SI-0004]
		CMP AX,0274H
		JNZ CHECKERROR
		JMP PUTJZBREAK
PUTJNZBREAK:
		MOV [WORD CS:BREAKJZNZ],"NZ"
		JMP PRO5COMOK
PUTJZBREAK:
		MOV [WORD CS:BREAKJZNZ],"JZ"

PRO5COMOK:
		CMP [BYTE EXEMARK],01H
		JZ PRO5EXEOK
		
		PUSH DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PROTECT5COMOK
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB
		POP DS
		JMP UNPRXCM5COM
SEEIFSIDIBXIND:
		MOV AL,[SI+0001H]
		CMP AL,04 ; SI?
		JZ CALCSI
		CMP AL,05 ; DI?
		JZ CALCDI
		CMP AL,07 ; BX?
		JZ CALCBX
		JMP CHECKERROR
CALCSI:
		CMP [BYTE CS:TYPEREG1],0BEH
		JZ GETVALUE
		CMP [BYTE CS:TYPEREG2],0BEH
		JZ GETVALUE2
		JMP CHECKERROR

CALCDI:
		CMP [BYTE CS:TYPEREG1],0BFH
		JZ GETVALUE
		CMP [BYTE CS:TYPEREG2],0BFH
		JZ GETVALUE2
		JMP CHECKERROR


CALCBX:
		CMP [BYTE CS:TYPEREG1],0BBH
		JZ GETVALUE
		CMP [BYTE CS:TYPEREG2],0BBH
		JZ GETVALUE2
		JMP CHECKERROR

GETVALUE:
		MOV AX,[WORD CS:REGVAL1]
		MOV [WORD CS:VALUEREG],AX
		JMP OHYES
GETVALUE2:
		MOV AX,[WORD CS:REGVAL2]
		MOV [WORD CS:VALUEREG],AX
		JMP OHYES


SEEIFSIDIBXINDNUMBA:
		MOV AL,[SI+0001H]
		MOV BX,[SI+0002H]
		AND AL,07H
		CMP AL,04 ; SI?
		JZ CALCSI2
		CMP AL,05 ; DI?
		JZ CALCDI2
		CMP AL,07 ; BX?
		JZ CALCBX2
		JMP CHECKERROR
CALCSI2:
		CMP [BYTE CS:TYPEREG1],0BEH
		JZ GETVALUE3
		CMP [BYTE CS:TYPEREG2],0BEH
		JZ GETVALUE32
		JMP CHECKERROR

CALCDI2:
		CMP [BYTE CS:TYPEREG1],0BFH
		JZ GETVALUE3
		CMP [BYTE CS:TYPEREG2],0BFH
		JZ GETVALUE32
		JMP CHECKERROR


CALCBX2:
		CMP [BYTE CS:TYPEREG1],0BBH
		JZ GETVALUE3
		CMP [BYTE CS:TYPEREG2],0BBH
		JZ GETVALUE32
		JMP CHECKERROR

GETVALUE3:
		MOV AX,[WORD CS:REGVAL1]
		ADD AX,BX
		MOV [WORD CS:VALUEREG],AX
		JMP OHYES
GETVALUE32:
		MOV AX,[WORD CS:REGVAL2]
		ADD AX,BX
		MOV [WORD CS:VALUEREG],AX
		JMP OHYES
PRO5EXEOK:
		JMP UNPRXCM5COM





CHECKPRXCM5UNREGEXE:
		JMP CONT5UNREG
PRX5UNREG:                
		DB 01EH,0EH,0EH,1FH,07H
PRX5UNREG2:                
		DB 01EH,0EH,0EH,07H,1FH
CONT5UNREG:
		MOV [BYTE CS:EXEMARK],01H
		MOV SI,[WORD CS:CHILDCSIP]
		MOV DI,OFFSET PRX5UNREG
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,0005H
		REP CMPSB
		JZ PRXCM5CHECKOK
		MOV SI,[WORD CS:CHILDCSIP]
		MOV DI,OFFSET PRX5UNREG2
		CLD
		MOV CX,0005H
		REP CMPSB
		JZ PRXCM5CHECKOK
		JMP CHECKERROR

PRXCM5CHECKOK:                
		
		MOV SI,0005
		XOR DI,DI
		JMP BIROUTINE


HELP:
		CALL HELPRINT
		MOV AX,4C00H
		INT 21H
MSGERR:
		MOV DX,OFFSET NOFOUND
		CALL PRINT
		JMP HELP
		MOV AX,4C00H
		INT 21H
CHECKPRXCMEXE:

		MOV SI,[WORD CS:CHILDCSIP]
		MOV DI,OFFSET PRXCMID2
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,0007H
		REP CMPSB
		JNZ CHECKPRXCM5UNREGEXE
		
		ADD SI,0002H
		MOV DI,OFFSET PRXCMID3
		CLD
		MOV CX,000CH
		REP CMPSB
		JNZ CHECKERROR
		
		INC SI
		MOV DI,OFFSET PRXCMID4
		CLD
		MOV CX,0003H
		REP CMPSB
		JNZ CHECKERROR
		
		PUSH DS

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM4EXEOK
		CALL PRINT
		CALL PAGK

		PUSH CS
		POP DS
		MOV AX,3D00H
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX

		MOV AH,3FH
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0020H
		MOV DX,OFFSET EXEHEADORIG
		INT 21H

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		
		POP DS
		
		MOV SI,[WORD CS:CHILDCSIP]
		MOV [WORD CS:DSEGMENT],DS
		MOV [WORD CS:OFFRUT4],SI
		PUSH CS
		POP DS
		CALL GETATTRIB
		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BREAKLOOP
		INT 21H
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]

		MOV [BYTE CS:ISJUMPINST],00
		MOV [BYTE CS:RETFLOOP],00
		MOV [BYTE CS:LASTLOOP],00
		
		MOV AH,62H
		INT 21H
		
		MOV [WORD CS:PID],BX
		MOV ES,BX
		
		MOV DS,[WORD CS:DSEGMENT]
		
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		MOV SI,[WORD CS:OFFRUT4]
		ADD SI,0019H
		MOV [WORD DS:SI],0F0CDH
		PUSH ES
		POP DS
		XOR SI,SI
		XOR DI,DI
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BREAKLOOP:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV SI,[WORD CS:OFFRUT4]
		ADD SI,001DH
S4L:                                            ; Search for loop
		MOV AH,[BYTE DS:SI]
		CMP AH,0E2H ; Es un maldito loop?
		JE PUTBREAKONLOOP
		CMP AH,0E0H ; Es un maldito loopnz?
		JE PUTBREAKONLOOP
		CMP AH,07FH ; Un jump if greater (JG)?
		JE PUTBREAKONLOOP
		CMP AH,075H ; Un jnz ?
		JE PUTBREAKONLOOP
		INC SI
		JMP S4L
PUTBREAKONLOOP:
		MOV AL,[BYTE DS:SI+01H]
		CMP AL,0FDH
		JB CONTPUT1
NOLOOP:
		ADD SI,0002H
		JMP S4L
CONTPUT1:
		CMP AL,0C7H
		JB NOLOOP
CONTPUT:
		CMP AH,0E2H
		JE SIGAMOS
		CMP AH,0E0H
		JE SIGAMOS
		MOV [BYTE CS:ISJUMPINST],01H


SIGAMOS:
		MOV [BYTE CS:TEMPBYTE],AL
		MOV [WORD DS:SI],0F0CDH
		
		MOV [WORD ES:03C0H],OFFSET BREAKLOOP1
		CMP [BYTE CS:RETFLOOP],01H
		JNE NOLASTLOOP
		MOV [BYTE CS:RETFLOOP],00H
		CALL POPTEMP
		POPF
		IRET

		
NOLASTLOOP:
		CALL POPTEMP
		MOV DS,BX
		POPF
		IRET
BREAKLOOP1:
		PUSHF
		CALL PUSHTEMP
		CMP [BYTE CS:ISJUMPINST],00
		JNE CONTIBREAK

		DEC CX
CONTIBREAK:
		CMP CX,0000
		JZ ENDLOOP1

		MOV DS,[WORD CS:DSEGMENT]
		MOV AL,[BYTE CS:TEMPBYTE]
		NEG AL
		XOR AH,AH
		MOV BX,SP
		MOV SI,[WORD SS:BX+0002H]
		SUB SI,AX
		MOV [WORD SS:BX+0002H],SI
		PUSH CX
		CALL POPTEMP
		POP CX
		POPF
		IRET
ENDLOOP1:
		MOV [WORD CS:TEMPCX],0000H
		MOV BX,SP
		MOV SI,[WORD SS:BX+0002H]
		MOV DS,[WORD CS:DSEGMENT]

BLOQUENOPS:
		MOV BX,SI
		MOV AL,[BYTE DS:SI]
		CMP AL,0FDH
		JE CHECK4NOPS
		INC SI
		JMP BLOQUENOPS
CHECK4RET12:
		PUSH CS
		POP ES
		MOV DI,OFFSET RETORNO12
		MOV CX,0006H
		CLD
		REP CMPSB
		JZ RETORNARBIEN
		MOV SI,BX
		INC SI
		JMP BLOQUENOPS
RETORNARBIEN:
		MOV [BYTE CS:LASTLOOP],01H
		SUB SI,000EH
		JMP PUTBREAKRETFNOW ; POR FIN!!!!!!!!



CHECK4NOPS:
		PUSH CS
		POP ES
		MOV DI,OFFSET BLOCKNOPS
		MOV CX,0009
		CLD
		REP CMPSB
		JZ SEARCHRETF 
		MOV SI,BX
		INC SI
		JMP BLOQUENOPS
SEARCHRETF:                
		ADD SI,00011
		MOV [WORD DS:SI],0F0CDH
		XOR AX,AX
		MOV ES,AX
		MOV [WORD ES:03C0H],OFFSET BREAKONRETF
		CALL POPTEMP
		POPF
		IRET
BREAKONRETF:
		PUSHF
		CALL PUSHTEMP
		MOV BX,SP
		MOV SI,[WORD SS:BX+0002H]
		MOV DS,[WORD CS:DSEGMENT]
SEERETF:                
		MOV AX,[WORD DS:SI]
		CMP AX,0E4FAH
		JE CHECKRETF
		CMP AX,0BB50H
		JE CHECK4RET12
		
		INC SI
		JMP SEERETF
CHECKRETF:
		CMP [WORD DS:SI+0CH],0CBFBH
		JE PUTBREAKRETFNOW
		INC SI
		JMP SEERETF
PUTBREAKRETFNOW:
		MOV [WORD DS:SI+0CH],0F0CDH
		XOR AX,AX
		MOV ES,AX
		MOV [WORD ES:03C0H],OFFSET SEEIFROUT
		CMP [BYTE CS:LASTLOOP],01H
		JE LASTLOOP1
		CALL POPTEMP
		POPF
		MOV DS,BX
		IRET
LASTLOOP1:
		MOV [WORD ES:03C0H],OFFSET PUTFUCKINGSHIT1
		CALL POPTEMP
		POPF
		MOV DS,BX
		IRET
		
SEEIFROUT:
		PUSHF
		CALL PUSHTEMP
		MOV BX,SP
		MOV AX,[WORD SS:BX+0008]
		CMP AX,0012H
		JE PUTFUCKINGSHIT1
		
		MOV SI,[WORD SS:BX+0002H]
		MOV DS,[WORD CS:DSEGMENT]
		SUB SI,0002H
		MOV [WORD SS:BX+0002H],SI

		MOV [WORD DS:SI],0CBFBH
		MOV DS,[WORD SS:BX+0AH]
		MOV [WORD CS:DSEGMENT],DS
		MOV [BYTE CS:ISJUMPINST],00
		MOV [BYTE CS:RETFLOOP],01
		MOV [BYTE CS:LASTLOOP],00
		XOR SI,SI
		JMP S4L

PUTFUCKINGSHIT1:
		PUSHF
		CALL PUSHTEMP
		MOV BX,SP
		
		MOV DS,[WORD SS:BX+0004H]
		MOV SI,[WORD SS:BX+0002H]
		SUB SI,0002H
		MOV [WORD DS:SI],0CB53H
		MOV [WORD SS:BX+0002H],SI


		MOV DS,[WORD CS:TEMPAX]
		MOV [WORD CS:POINTCS],DS
		
		MOV [WORD CS:OFFRUT4],0026
		MOV BX,[WORD CS:OFFRUT4]
		ADD BX,0029
		MOV ES,[WORD CS:POINTCS]
		MOV [WORD ES:BX],0F0CDH
		XOR AX,AX
		MOV ES,AX

		MOV [WORD ES:03C0H],OFFSET BREAK0EXE
		CALL POPTEMP
		POPF
		IRET




BREAK0EXE:
		
		MOV SI,0200H
		REP MOVSW
		CALL PUSHTEMP
		MOV BX,[WORD CS:OFFRUT4]
		MOV DS,[WORD CS:POINTCS]
		MOV [WORD DS:BX+4FH],0F0CDH
		MOV [WORD ES:03C0H],OFFSET BREAK1EXE
		CALL POPTEMP
		IRET
		
BREAK1EXE:
		MOV AL,0FFH
		OUT 21H,AL
		CALL PUSHTEMP
		MOV BX,[WORD CS:OFFRUT4]
		MOV DS,[WORD CS:POINTCS]
		MOV [WORD DS:BX+0055H],83CDH
		MOV [WORD DS:BX+0057H],03EBH
		
		LDS DX,[DWORD ES:0000H]
		MOV [WORD CS:OLDINT00],DX
		MOV [WORD CS:OLDINT00+02H],DS
		LDS DX,[DWORD ES:0200H]
		MOV [WORD ES:0000],DX
		MOV [WORD ES:0002],DS
		MOV DS,[WORD CS:POINTCS]
		MOV BX,[WORD ES:020CH]
		MOV [WORD DS:BX+002FH],0F0CDH
		MOV [WORD ES:03C0H],OFFSET BREAK2EXE
		CALL POPTEMP
		IRET
BREAK2EXE:
		CALL PUSHTEMP
		MOV BX,[WORD CS:OFFRUT4]
		MOV DS,[WORD CS:POINTCS]
		MOV [WORD DS:BX+00E4H],082CDH
		MOV [WORD ES:03C0H],OFFSET BREAK3EXE
		MOV [WORD DS:BX+00D8H],0F0CDH
		MOV [BYTE DS:BX+0060H],90H
		MOV [BYTE DS:BX+006DH],90H
		MOV [BYTE DS:BX+007DH],90H
		MOV [BYTE DS:BX+0083H],90H
		MOV DS,[WORD ES:0002H]
		MOV [WORD DS:0171H],0F0CDH
		CALL POPTEMP
		XOR BL,BL
		IRET
BREAK3EXE:
		CALL PUSHTEMP
		MOV [WORD CS:SIZEEXE1],BP
		MOV [WORD CS:SIZEEXE2],CX
		MOV [WORD ES:03C0H],OFFSET BREAK4EXE
		MOV DS,[WORD ES:0002H]
		MOV [WORD DS:0171H],0F631H
		CALL POPTEMP
		XOR SI,SI
		IRET

BREAK4EXE:         
		MOV DI,0200H
		REP MOVSW
		CALL PUSHTEMP
		MOV BX,[WORD CS:OFFRUT4]
		MOV DS,[WORD CS:POINTCS]
		MOV [WORD DS:BX+011CH],0F0CDH
		MOV [WORD ES:03C0H],OFFSET BREAK5EXE
		MOV AL,[BYTE DS:BX+00F7H]
		CMP AL,00F9H
		JZ NOHAYRELOC
HAYRELOC:
		INC [BYTE CS:RELOC]
		MOV [WORD DS:BX+0107H],09090H
		MOV [WORD DS:BX+0109H],09090H
		MOV [BYTE DS:BX+010BH],90H              
NOHAYRELOC:
		CALL POPTEMP
		IRET
BREAK5EXE:
		POP AX ; reestablezco ip
		POP AX ;     ' '      cs
		POP AX ;     ' '      Flags  :)
		POP AX ;     ' '      ip ORIGINAL
		MOV [WORD CS:EXEIP],AX
		POP AX ;     ' '      CS ORIGINAL
		MOV [WORD CS:EXECS],AX
		MOV [WORD CS:EXESS],SS
		MOV [WORD CS:EXESP],SP
		
		MOV SS,[WORD CS:INITSSSP]
		MOV SP,[WORD CS:INITSSSP+02H]

		CMP [BYTE CS:RELOC],01H
		JB NORELOCAT
		MOV [WORD CS:EXEHEAD+0005H],0100H
		MOV [WORD CS:EXEHEAD+0017H],1C00H
		MOV [WORD CS:EXEHEAD+001BH],0700H
		MOV [WORD CS:EXEHEAD+001DH],0000H
NORELOCAT:
		MOV AX,[WORD CS:EXESP]
		MOV BX,[WORD CS:EXEIP]
		ADD AX,0002
		MOV [WORD CS:EXEHEAD+0010H],AX
		MOV [WORD CS:EXEHEAD+0014H],BX
		MOV AX,[WORD CS:EXECS]
		MOV BX,[WORD CS:EXESS]
		MOV CX,DS
		SUB AX,CX
		SUB AX,0010H
		SUB BX,CX
		SUB BX,0010H
		MOV [WORD CS:EXEHEAD+000EH],BX
		MOV [WORD CS:EXEHEAD+0016H],AX
		MOV [WORD CS:EXEHEAD],"ZM" 
		MOV AX,25F0H
		LDS DX,[DWORD CS:INTF0IP]
		INT 21H; Last Break Point
SAVEFUCKEXE:
		MOV AX,[WORD CS:SIZEEXE1]
		INC AX
		MOV BX,0010H
		MUL BX
		MOV [WORD CS:HIGHSIZE],DX
		MOV [WORD CS:LOWSIZE],AX
SAVE4LZ:                
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID],BX
		PUSH CS
		POP DS
		MOV AX,3D02H
		MOV CX,0020H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		
		PUSH CS
		POP DS
		MOV DX,OFFSET EXEHEAD
		MOV CX,0020H
		CALL WRITEEXE

		
		MOV CX,[WORD CS:PID]
		ADD CX,0010H
		MOV DS,CX
		MOV DX,0000H
		CMP [WORD CS:HIGHSIZE],0001H
		JNB BLOCKMAYOR
		MOV CX,[WORD CS:LOWSIZE]
		CALL WRITEEXE
		JMP CLOSE
BLOCKMAYOR:
		DEC [WORD CS:HIGHSIZE]
		MOV CX,8000H
		CALL WRITEEXE
		ADD DX,8000H
		MOV CX,8000H
		CALL WRITEEXE
		MOV AX,DS
		ADD AX,1000H
		MOV DS,AX
		MOV DX,0000
		CMP [WORD CS:HIGHSIZE],0001H
		JNB BLOCKMAYOR
		MOV CX,[WORD CS:LOWSIZE]
		CALL WRITEEXE
		JMP CLOSE                               
		


WRITEEXE:
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		RETN
CLOSE:
		MOV AH,3EH
		INT 21H

		XOR AX,AX
		MOV ES,AX
		PUSH CS
		POP DS
		MOV SI,OFFSET BACKUPINT
		MOV DI,0
		MOV CX,4*0100H
		CLD
		REP MOVSB
		
SETSIZE:
		MOV AH,2FH
		INT 21H

		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV DX,[WORD ES:009CH]
		MOV AX,[WORD ES:009AH]
		MOV BX,0200H
		XOR CX,CX
		DIV BX
		CMP DX,0000
		JE HEADMUL512
		INC AX
HEADMUL512:                
		MOV [WORD CS:EXEHEAD+0004H],AX
		MOV [WORD CS:EXEHEAD+0002H],DX
		
		CMP [BYTE CS:SCRE2B],01H
		JE SETATTRIBEXE

		MOV SI,OFFSET EXEHEADORIG+000AH
		MOV DI,OFFSET EXEHEAD+000AH
		CLD
		MOV CX,0004H
		PUSH CS
		POP ES
		REP MOVSB


SETATTRIBEXE:
		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX
		PUSH CS
		POP DS
		MOV CX,001CH
		MOV DX,OFFSET EXEHEAD
		CALL WRITEEXE
		
		MOV BX,[WORD CS:HANDLE]
		MOV AX,5701H
		MOV CX,[WORD CS:TIME]
		MOV DX,[WORD CS:DATE]
		INT 21H
		MOV AH,3EH
		INT 21H
		MOV AX,4301H
		MOV DX,OFFSET TEMPPARAMETERS
		MOV CX,[WORD CS:ATRIB]
		INT 21H
		
		PUSH CS
		POP DS
		
		JMP FIN1
UNPRXCM5COM:
FUCKCOM5:         
		MOV [WORD CS:DSEGMENT],DS
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRK50
		INT 21H
FUCKPRX5:
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		
		MOV AH,62H
		INT 21H
		
		MOV DS,[WORD CS:DSEGMENT]
		MOV ES,BX
		
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
PUTJZNZ:
		MOV SI,[WORD CS:VALUEREG]
		CMP [WORD CS:BREAKJZNZ],"NZ"
		JNZ PUTJZ            
		MOV AL,[BYTE DS:SI-0001H]
		MOV [BYTE CS:NZNUMBA],AL
		MOV [WORD DS:SI-0002H],0F0CDH
		JMP RUNPROGRAM
PUTJZ:
		MOV [WORD DS:SI-0004H],0F0CDH
RUNPROGRAM:
		MOV AX,ES
		MOV DS,AX
		XOR SI,SI
		XOR DI,DI
		XOR AX,AX
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]

BRK50:
		PUSHF
		CALL PUSHTEMP
		CMP [WORD CS:BREAKJZNZ],"JZ"
		JE PUTJZBREAK2
		POPF

		JZ GOANDFUCK2
		PUSHF
		MOV AL,[BYTE CS:NZNUMBA]
		CMP AL,80H
		JAE RETRO2
AVANCE2:
		XOR AH,AH
		MOV SI,[WORD CS:VALUEREG]
		SUB SI,0002H
		ADD SI,AX
		ADD SI,0002H
		JMP VEREMOS2
RETRO2:
		NEG AL
		XOR AH,AH
		MOV SI,[WORD CS:VALUEREG]
		SUB SI,0002H
		SUB SI,AX
		ADD SI,0002H
VEREMOS2:

		POPF 
		MOV [WORD CS:SIMULATEDJUMP],SI
		MOV [WORD CS:SIMULATEDJUMP+0002H],DS
		POP AX
		POP AX
		POP AX
		CALL POPTEMP
		JMP [DWORD CS:SIMULATEDJUMP]
SIMULATEDJUMP:
		DB 000H,000H,000H,000H
PUTJZBREAK2:
		POPF
		JZ GOANDFUCK
		CALL POPTEMP
		IRET
GOANDFUCK:                
		PUSHF
		POP CX

		POP AX
		ADD AX,0002H
		PUSH AX
		PUSH CX
		POPF
GOANDFUCK2:                
		MOV DS,[WORD CS:DSEGMENT]
		MOV BX,[WORD CS:VALUEREG]
		CMP [BYTE CS:EXEMARK],01H
		JNE NOTEXEPHILE
		CMP [WORD DS:BX+56H],01CDH
		JZ PRXCM5REGD
		
		PUSH DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PROTECT5EXEOK
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB
		POP DS

NOTEXEPHILE:
		MOV [WORD DS:BX+02BH],020CH
		MOV [WORD DS:BX+035H],020EH
		MOV [WORD DS:BX+049H],0204H
		MOV [WORD DS:BX+04FH],0206H
		MOV AX,[WORD DS:BX+05BH]
		MOV [WORD CS:TEMPBYTE],AX
		
		MOV [WORD DS:BX+056H],083CDH
		MOV [WORD DS:BX+058H],0E2ABH
		MOV [BYTE DS:BX+05AH],0FBH
		MOV [WORD DS:BX+05BH],0F0CDH

		MOV [WORD DS:BX+0BBH],081CDH
		
		MOV [WORD DS:BX+06BH],0204H
		MOV [WORD DS:BX+07EH],0206H
		MOV [WORD DS:BX+083H],020CH
		MOV [WORD DS:BX+087H],020EH
COMMON:                
		MOV [WORD ES:03C0H],OFFSET BRK51
		CALL POPTEMP
		IRET
BRK51:
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV AX,[WORD CS:TEMPBYTE]
		MOV BX,[WORD CS:VALUEREG]
		MOV [WORD DS:BX+05BH],AX
		PUSHF
		POP CX
		POP AX
		CMP [BYTE CS:REGD],01H                
		JNE UNREGD
		ADD AX,003BH
		JMP CONTREGDORUNREGD
UNREGD:
		ADD AX,003AH
CONTREGDORUNREGD:
		PUSH AX
		CMP [BYTE CS:EXEMARK],01H                
		JZ BREAK51EXE
		MOV [WORD DS:BX+0E7H],0204H
		MOV [WORD DS:BX+0F1H],0284H
		MOV [WORD DS:BX+0F8H],0204H
		MOV [WORD DS:BX+0110H],0284H
		MOV [WORD DS:BX+015CH],0A1CDH
		MOV [WORD DS:BX+014FH],0F0CDH
		MOV [BYTE DS:BX+0151H],090H
		JMP BREAK51CONT
BREAK51EXE:                
		MOV [WORD DS:BX+00EFH],0204H                 
		MOV [WORD DS:BX+00F9H],0220H
		MOV [WORD DS:BX+0100H],0204H
		MOV [WORD DS:BX+0118H],0220H
		MOV [BYTE DS:BX+016EH],0088H
		MOV [WORD DS:BX+0160H],0F0CDH
		MOV [BYTE DS:BX+0162H],090H
BREAK51CONT:
		MOV [WORD ES:03C0H],OFFSET BRK52
		PUSH CX
		POPF
		CALL POPTEMP                
		IRET

BRK52:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		CMP [BYTE CS:EXEMARK],01H
		JE BRK52EXE

		MOV AX,CX
		MOV BX,0002H
		MUL BX
		MOV [WORD CS:FILESIZECOM],AX
		MOV AX,[WORD DS:BX+0161H]
		MOV [WORD CS:TEMPBYTE],AX
		MOV BX,[WORD CS:VALUEREG]
		MOV [WORD DS:BX+015DH],83CDH
		MOV [WORD DS:BX+015FH],0FBE2H
		MOV [WORD DS:BX+0161H],0F0CDH
		JMP ENDBRK52
DATAROUT:
		DB 0CDH,083H,0E2H,0FBH,08CH,0D8H,040H,08EH,0D8H,08EH
		DB 0C0H,0B9H,008H,000H,033H,0F6H,033H,0FFH,02EH,0FFH
		DB 08EH,0D3H,001H,075H,0E6H,0CDH,0F0H
BRK52EXE:                
		MOV AX,DS
		MOV ES,AX
		PUSH CS
		POP DS
		MOV SI,OFFSET DATAROUT
		MOV DI,[WORD CS:VALUEREG]
		ADD DI,016EH
		MOV CX,001BH
		CLD
		REP MOVSB
		MOV CX,[WORD ES:BP+01D3H]
		MOV [WORD CS:SIZEEXE1],CX
ENDBRK52:
		PUSHF
		XOR AX,AX
		MOV ES,AX
		POPF
		MOV [WORD ES:03C0H],OFFSET BRK53
		CALL POPTEMP
		POPF
		AND AH,01H
		IRET
BRK53:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		CMP [BYTE CS:EXEMARK],01
		JZ BRK53EXE
		POPF

		MOV AX,[WORD CS:TEMPBYTE]
		MOV BX,[WORD CS:VALUEREG]
		MOV [WORD DS:BX+0161H],AX
		PUSHF
		POP CX
		POP AX
		ADD AX,0016H
		PUSH AX
		PUSH CX
		POPF
		MOV [WORD DS:BX+016EH],0F0CDH
		MOV [WORD DS:BX+0170H],09090H
		MOV [BYTE DS:BX+0172H],090H
		JMP ENDBRK53
BRK53EXE:
		MOV BX,[WORD CS:VALUEREG]
		MOV [BYTE DS:BX+01ADH],81H
		MOV [WORD DS:BX+01F4H],0204H
		MOV [WORD DS:BX+0206H],0220H
		MOV [WORD DS:BX+0287H],0F0CDH
		MOV [WORD DS:BX+0190H],09090H
		MOV [WORD DS:BX+0192H],09090H
		MOV [WORD DS:BX+0194H],09090H
		MOV [WORD DS:BX+0196H],09090H
		MOV [BYTE DS:BX+0198H],090H
		MOV [WORD DS:BX+0190H],0F0CDH

		POPF
		POP AX
		ADD AX,0016H
		PUSH AX
		
ENDBRK53:                
		MOV [WORD ES:03C0H],OFFSET BRK54
		CALL POPTEMP                
		IRET
BRK54:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		
		MOV BX,[WORD CS:VALUEREG]
		CMP [BYTE CS:EXEMARK],01
		JZ BRK54EXE
		
		MOV [BYTE DS:BX+0187H],81H
		MOV [WORD DS:BX+01AEH],0204H
		MOV [WORD DS:BX+01C0H],0284H
		MOV [WORD DS:BX+01F6H],0F0CDH
		JMP ENDBRK54
BRK54EXE:
		MOV CX,[WORD DS:BP+01E9H]
		OR CX,CX
		JZ ENDBRK54EXE
			   
		MOV [WORD CS:CANTRELOC],CX
		MOV [WORD DS:BX+0241H],0F0CDH
		MOV [WORD ES:03C0H],OFFSET BRKINTERMEDIO
		CALL POPTEMP
		POPF
		IRET
BRKINTERMEDIO:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		ADD SI,BP
		ADD SI,01E3H
		MOV [WORD CS:OFFSETRELOC],SI
		MOV [WORD ES:03C0H],OFFSET BRK55EXE
		XOR DI,DI
		
		MOV AX,DS
		MOV ES,AX
		MOV BX,[WORD CS:VALUEREG]
		MOV DI,0243H
		ADD DI,BX
		MOV CX,0011H
		MOV AL,090H
		REP STOSB
		POPF
		CALL POPTEMP
		IRET

ENDBRK54:
		MOV [WORD ES:03C0H],OFFSET BRK55
		POPF
		CALL POPTEMP                
		IRET
ENDBRK54EXE:
		MOV [WORD ES:03C0H],OFFSET BRK55EXE
		POPF
		CALL POPTEMP                
		IRET
BRK55:
		POP AX
		POP AX
		POP AX
		POP AX
		POP AX
		MOV AX,25F0H
		LDS DX,[DWORD CS:INTF0IP]
		INT 21H; Last Break Point
		JMP SAVEFUCK2
BRK55EXE:
		POP AX ; reestablezco ip
		POP AX ;     ' '      cs
		MOV [WORD CS:TEMPBYTE],AX
		POP AX ;     ' '      Flags  :)
		POP AX ;     ' '      ip ORIGINAL
		MOV [WORD CS:EXEIP],AX
		POP AX ;     ' '      CS ORIGINAL
		MOV [WORD CS:EXECS],AX
		MOV [WORD CS:EXESS],SS
		MOV [WORD CS:EXESP],SP
		
		MOV SS,[WORD CS:INITSSSP]
		MOV SP,[WORD CS:INITSSSP+02H]
		
		MOV CX,[WORD CS:CANTRELOC]
		MOV [WORD CS:EXEHEAD+0006H],CX
		MOV [WORD CS:EXEHEAD+0017H],1C00H
		
		PUSH DS
		PUSH CS
		POP DS
		MOV AX,3D00H
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX


		MOV AH,3FH
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0020H
		MOV DX,OFFSET EXEHEADORIG
		INT 21H

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H

		POP DS

		MOV AX,[WORD CS:EXESP]
		MOV BX,[WORD CS:EXEIP]
		MOV [WORD CS:EXEHEAD+0010H],AX
		MOV [WORD CS:EXEHEAD+0014H],BX
		MOV AX,[WORD CS:EXECS]
		MOV BX,[WORD CS:EXESS]
		MOV CX,DS
		SUB AX,CX
		SUB AX,0010H
		SUB BX,CX
		SUB BX,0010H
		MOV [WORD CS:EXEHEAD+000EH],BX
		MOV [WORD CS:EXEHEAD+0016H],AX
		MOV [WORD CS:EXEHEAD],"ZM" 
		PUSH DS
		MOV AX,25F0H
		LDS DX,[DWORD CS:INTF0IP]
		INT 21H; Last Break Point
		POP DS
SAVEFUCKEXE2:
		MOV AX,[WORD CS:SIZEEXE1]
		MOV BX,0010H
		MUL BX
		MOV [WORD CS:HIGHSIZE],DX
		MOV [WORD CS:LOWSIZE],AX
SAVELZEXE:                
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID],BX
		PUSH CS
		POP DS
		MOV AX,3D02H
		MOV CX,0020H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		
		PUSH CS
		POP DS
		MOV DX,OFFSET EXEHEAD
		MOV CX,001CH
		CMP [WORD CS:CANTRELOC],0001H
		JAE SEGUIR
		MOV CX,0020H
SEGUIR:
		CALL WRITEEXE
		CMP [WORD CS:CANTRELOC],0001H
		JB SAVEMODULE
		POP DS
		MOV AX,[WORD CS:CANTRELOC]
		MOV BX,0004H
		MUL BX
		MOV CX,AX
		MOV DX,[WORD CS:OFFSETRELOC]
		PUSH DS
		MOV AX,[WORD CS:TEMPBYTE]
		MOV DS,AX
		CALL WRITEEXE
		
FIXHEADLENGH:                
		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		
		PUSH CS
		POP DS
		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV AH,2FH
		INT 21H
		
		MOV AX,[WORD ES:009AH]
		MOV BX,0010H
		CWD
		DIV BX
		MUL BX
		ADD AX,0010H
		SUB AX,[WORD ES:009AH]
		PUSH AX

		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H

		POP CX
		CMP CX,0010H
		JNE FOLLOW2
		XOR CX,CX
FOLLOW2:
		MOV DX,OFFSET HEADFILL
		CALL WRITEEXE

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		
		PUSH CS
		POP DS
		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV AH,2FH
		INT 21H
		
		MOV AX,[WORD ES:009AH]
		MOV BX,0010H
		CWD
		DIV BX
		MOV [WORD CS:EXEHEAD+0008H],AX

		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX

		MOV CX,001CH
		MOV DX,OFFSET EXEHEAD
		CALL WRITEEXE

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H

		POP DS


SAVEMODULE:
		MOV CX,[WORD CS:PID]
		ADD CX,0010H
		MOV DS,CX
		MOV DX,0000H
		CMP [WORD CS:HIGHSIZE],0001H
		JNB BLOCKMAYOR2
		MOV CX,[WORD CS:LOWSIZE]
		CALL WRITEEXE
		JMP CLOSE2
BLOCKMAYOR2:
		DEC [WORD CS:HIGHSIZE]
		MOV CX,8000H
		CALL WRITEEXE
		ADD DX,8000H
		MOV CX,8000H
		CALL WRITEEXE
		MOV AX,DS
		ADD AX,1000H
		MOV DS,AX
		MOV DX,0000
		CMP [WORD CS:HIGHSIZE],0001H
		JNB BLOCKMAYOR2
		MOV CX,[WORD CS:LOWSIZE]
		CALL WRITEEXE
		JMP CLOSE2                               
		


CLOSE2:
		MOV AH,3EH
		INT 21H

		XOR AX,AX
		MOV ES,AX
		PUSH CS
		POP DS
		MOV SI,OFFSET BACKUPINT
		MOV DI,0
		MOV CX,4*0100H
		CLD
		REP MOVSB
		JMP SETSIZE
		
UNPRXCM4:
		MOV DS,[WORD CS:CHILDCSIP+2]
		MOV SI,[WORD CS:CHILDCSIP]
		XOR BX,BX
		MOV AX,[WORD BX+SI+01]
		ADD AX,0103H
		MOV [WORD CS:OFFRUT4],AX
		PUSH DS
		CALL GETATTRIB
		JMP FUCKCOMS
GETATTRIB:
		PUSH ES
		PUSH BX
		PUSH CS
		POP DS
		MOV AX,4300H
		MOV DX,OFFSET LINEPARAMETERS
		INT 21h
		
		MOV [WORD CS:ATRIB],CX
		
		MOV AX,3D00H
		MOV DX,OFFSET LINEPARAMETERS
		INT 21h
		MOV [WORD CS:HANDLE],AX
		
		MOV AH,3FH
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0020H
		MOV DX,OFFSET EXEHEADORIG
		INT 21H

		MOV AX,5700H
		INT 21H
		MOV [WORD CS:TIME],CX
		MOV [WORD CS:DATE],DX
		MOV AH,3EH
		INT 21H
CHANGEATTRIB:
		MOV AX,4301H
		MOV DX,OFFSET LINEPARAMETERS
		XOR CX,CX
		INT 21h
		MOV AX,4301H
		MOV DX,OFFSET TEMPPARAMETERS
		XOR CX,CX
		INT 21h
		MOV AX,3C00H
		MOV CX,0020H
		PUSH CS
		POP DS
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV BX,AX
		MOV AH,3EH
		INT 21H
		MOV AH,2FH
		INT 21H
		MOV [WORD CS:POINTDTATEMP],BX
		MOV [WORD CS:POINTDTATEMP+02H],ES
		CMP [WORD CS:EXEHEADORIG],"ZM"
		JZ SEEOVERLAY
		CMP [WORD CS:EXEHEADORIG],"MZ"
		JZ SEEOVERLAY
NOHEADER:                
		POP BX
		POP ES
		RETN
SEEOVERLAY:
		MOV AH,4EH
		MOV CX,00FFH
		PUSH CS
		POP DS
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H
		
		CLC
		MOV AX,[WORD CS:EXEHEADORIG+04H]
		CMP [WORD CS:EXEHEADORIG+02H],0000                
		JE NOPARTIAL
		DEC AX
NOPARTIAL:
		XOR DX,DX
		MOV BX,0200H
		MUL BX
		CLC
		ADD AX,[WORD CS:EXEHEADORIG+02H]
		ADC DX,0000H
		MOV BX,DX
		LDS DX,[DWORD CS:POINTDTATEMP]
		XCHG BX,DX
		CMP DX,[WORD DS:BX+1CH]
		JE CHECKLSB
		JMP CALCULPOS

CHECKLSB:
		CMP AX,[WORD DS:BX+1AH]
		JE RETURN
		JMP CALCULPOS
RETURN:
		JMP NOHEADER
CALCULPOS:
		MOV [WORD CS:CXHIGH],DX                
		MOV [WORD CS:DXLOW],AX
		MOV [BYTE CS:OVERLAY],01H
		JMP RETURN
		
FUCKCOMS:         
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BREAK0
		INT 21H
FUCKPROGRAM:
		POP DS
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		MOV AX,DS
		MOV [WORD CS:DSEGMENT],AX
		MOV ES,AX
		XOR AX,AX
		XOR CX,CX
		XOR DX,DX
		MOV BX,[WORD CS:OFFRUT4]
		ADD BX,0021
		MOV [WORD DS:BX],0F0CDH
		XOR BX,BX
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]

BREAK0:
		MOV [WORD CS:FILESIZECOM],BP
		MOV SI,0200H
		REP MOVSW
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV BX,[WORD CS:OFFRUT4]
		MOV [WORD DS:BX+4FH],0F0CDH
		MOV [WORD ES:03C0H],OFFSET BREAK1
		CALL POPTEMP
		IRET
		
BREAK1:
		MOV AL,0FFH
		OUT 21H,AL
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV BX,[WORD CS:OFFRUT4]
		MOV [WORD DS:BX+0055H],83CDH
		MOV [WORD DS:BX+0057H],03EBH
		MOV [WORD ES:0202H],DS
		MOV [WORD ES:0206H],DS
		MOV [WORD ES:020AH],DS
		MOV [WORD ES:020EH],DS
		
		LDS DX,[DWORD ES:0000H]
		MOV [WORD CS:OLDINT00],DX
		MOV [WORD CS:OLDINT00+02H],DS
		LDS DX,[DWORD ES:0200H]
		MOV [WORD ES:0000],DX
		MOV [WORD ES:0002],DS
		MOV DS,[WORD CS:DSEGMENT]
		MOV [WORD DS:BX+01C9H],0F0CDH
		MOV [WORD ES:03C0H],OFFSET BREAK2
		CALL POPTEMP
		IRET
BREAK2:
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV BX,[WORD CS:OFFRUT4]
		MOV [WORD DS:BX+00C5H],082CDH
		MOV [WORD ES:03C0H],OFFSET BREAK3
		MOV [WORD DS:BX+00B9H],0F0CDH
		MOV [BYTE DS:BX+0060H],90H
		MOV [BYTE DS:BX+006BH],90H
		MOV [BYTE DS:BX+007BH],90H
		MOV [BYTE DS:BX+0081H],90H
		CALL POPTEMP
		XOR BL,BL
		IRET
BREAK3:         
		MOV DI,0200H
		REP MOVSW
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV BX,[WORD CS:OFFRUT4]
		MOV [WORD DS:BX+00DCH],0F0CDH
		MOV [WORD ES:03C0H],OFFSET BREAK4
		CALL POPTEMP
		IRET
BREAK4:
		POP AX
		POP AX
		POP AX
		POP AX
		POP AX
		MOV AX,25F0H
		LDS DX,[DWORD CS:INTF0IP]
		INT 21H; Last Break Point
SAVEFUCK:
		ADD [WORD CS:FILESIZECOM],000FH
SAVEFUCK2:
		
		MOV AX,3D02H
		PUSH CS
		POP DS
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		
		CMP [WORD CS:EXEHEADORIG],"MZ"
		JZ WRITEHEADER
		CMP [WORD CS:EXEHEADORIG],"ZM"
		JZ WRITEHEADER
		JMP WRITEMODULE
WRITEHEADER:
		MOV [BYTE CS:EXEMARK],01H
		MOV [BYTE CS:HEADORIG],01H

		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0020H
		PUSH CS
		POP DS
		MOV DX,OFFSET EXEHEADORIG
		INT 21H


WRITEMODULE:
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,[WORD CS:FILESIZECOM]
		LDS DX,[DWORD CS:CHILDCSIP]
		INT 21H
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		INT 21H

		MOV AH,3EH
		INT 21H
		XOR AX,AX
		MOV ES,AX
		PUSH CS
		POP DS
		MOV SI,OFFSET BACKUPINT
		MOV DI,0
		MOV CX,4*0100H
		CLD
		REP MOVSB
SETATTRIB:
		CMP [BYTE CS:EXEMARK],01H
		JNE SETCOM
		PUSH CS
		POP DS
		PUSH CS
		POP ES
		MOV SI,OFFSET EXEHEADORIG
		MOV DI,OFFSET EXEHEAD
		MOV CX,001CH
		CLD
		REP MOVSB
		JMP SETSIZE
SETCOM:
		MOV AX,3D00H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV BX,AX
		MOV AX,5701H
		MOV CX,[WORD CS:TIME]
		MOV DX,[WORD CS:DATE]
		INT 21H
		
		MOV AH,3EH
		INT 21H
		MOV AX,4301H
		MOV DX,OFFSET TEMPPARAMETERS
		MOV CX,[WORD CS:ATRIB]
		INT 21H
		
		PUSH CS
		POP DS
		
		JMP FIN1

PUSHTEMP:
		MOV [WORD CS:TEMPAX],AX
		MOV [WORD CS:TEMPBX],BX
		MOV [WORD CS:TEMPCX],CX
		MOV [WORD CS:TEMPDX],DX
		MOV [WORD CS:TEMPDS],DS
		MOV [WORD CS:TEMPES],ES
		MOV [WORD CS:TEMPSI],SI
		MOV [WORD CS:TEMPDI],DI
		XOR AX,AX
		MOV ES,AX
		RETN
POPTEMP:
		MOV AX,[WORD CS:TEMPAX]
		MOV BX,[WORD CS:TEMPBX]
		MOV CX,[WORD CS:TEMPCX]
		MOV DX,[WORD CS:TEMPDX]
		MOV DS,[WORD CS:TEMPDS]
		MOV ES,[WORD CS:TEMPES]
		MOV SI,[WORD CS:TEMPSI]
		MOV DI,[WORD CS:TEMPDI]
		RETN

HELPRINT:
		MOV DX,OFFSET HELPTEXT
		CALL PRINT
		CMP [BYTE CS:BYTEREGISTERED],01H
		JE HELPREGD

		MOV DX,OFFSET HELPNOPATENT
		CALL PRINT
		RET
HELPREGD:
		MOV DX,OFFSET HELPWITHKEY
		CALL PRINT
		MOV DX,OFFSET KEYREPPLY
		CALL PRINT
		RET


INTRO:
		MOV DX,OFFSET INTROTITLE
		CALL PRINT

		MOV AX,3D02H
		MOV DX,OFFSET KEYNAME
		INT 21H
		JC SHOWNOPATENT
		MOV [WORD CS:HANDLE],AX

		MOV AH,3FH
		MOV BX,[WORD CS:HANDLE]
		MOV CX,155
		MOV DX,OFFSET KEYREPPLY
		INT 21H
		CMP AX,155
		JB SHOWNOPATENT

		MOV SI,OFFSET KEYREPPLY
		MOV DI,OFFSET KEYID
		MOV CX,154
		PUSH CS
		POP DS
		PUSH CS
		POP ES
		CLD
		REP CMPSB
		JNZ SHOWNOPATENT

		LODSB
		CMP AL,0E0H
		JE KEYOK
		CMP AL,0E1H
		JE KEYOK
		CMP AL,0E2H
		JE KEYOK
		JMP SHOWNOPATENT
KEYOK:
		MOV [BYTE CS:KEYTYPE],AL

		MOV AH,3FH
		MOV BX,[WORD CS:HANDLE]
		MOV CX,42
		MOV DX,OFFSET KEYREPPLY
		INT 21H
		CMP AX,0042
		JNE SHOWNOPATENT

		MOV SI,OFFSET KEYREPPLY
		MOV DI,SI
		MOV CX,0042
		MOV BL,[BYTE CS:KEYTYPE]
DECRYPT:                
		LODSB
		XOR AL,BL
		STOSB
		SUB BL,22h
		LOOP DECRYPT

		MOV SI,OFFSET KEYREPPLY
		MOV DI,SI
		MOV CX,0040
		MOV BL,[BYTE CS:KEYTYPE]
		XOR DX,DX
		XOR AX,AX
CHECKSUM:                
		LODSB
		ADD DX,AX
		LOOP CHECKSUM

		CMP DX,[WORD CS:SI]
		JNE SHOWNOPATENT

		MOV [BYTE CS:BYTEREGISTERED],01H

		CMP [BYTE CS:KEYTYPE],0E0H 
		JE SHOWREGISTERED
		CMP [BYTE CS:KEYTYPE],0E1H 
		JE SHOWBETATESTER
		CMP [BYTE CS:KEYTYPE],0E2H 
		JE SHOWDISTROSITE

SHOWREGISTERED:
		MOV DX,OFFSET REGISTERED
		CALL PRINT
		RETN
SHOWBETATESTER:
		MOV DX,OFFSET BETA
		CALL PRINT
		RETN
SHOWDISTROSITE:
		MOV DX,OFFSET DISTROSITE
		CALL PRINT
		RETN
SHOWNOPATENT:                
		MOV DX,OFFSET NOPATENT
		CALL PRINT
		RETN

PRINT:
		PUSH CS
		POP  DS
		MOV AH,09H
		INT 21H
		RETN

PAGK: ; Press And Get Key :)
		
		PUSH CS
		POP  DS
		MOV AH,09H
		MOV DX,OFFSET REMOVE
		INT 21H
GETKEY:
		MOV AH,08H
		INT 21H
		CMP AL,79H
		JE LETCONT
		CMP AL,59H
		JE LETCONT
		CMP AL,4EH
		JE DONTCONT
		CMP AL,6EH
		JE DONTCONT
		JMP GETKEY
LETCONT:                
		CALL PRINTCHAR
		RETN
DONTCONT:
		CALL PRINTCHAR
		POP AX
		MOV DX,OFFSET CARRIAGE
		CALL PRINT
		JMP FIN2

PRINTCHAR:            
		MOV AH,02H
		MOV DL,AL
		INT 21H
		RETN

DTANORMAL:                
		MOV AH,1AH
		LDS DX,[DWORD CS:DTAPOINTERS]
		INT 21H
		RETN

PRXCM5REGD:
		MOV [BYTE CS:REGD],01H
		PUSH DS
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PROTECT5REGDEXEOK
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB
		POP DS
	      
		MOV [WORD DS:BX+02BH],0204H
		MOV [WORD DS:BX+035H],0206H
		MOV [WORD DS:BX+049H],020CH
		MOV [WORD DS:BX+04FH],020EH
		MOV AX,[WORD DS:BX+05BH]
		MOV [WORD CS:TEMPBYTE],AX
		
		MOV [WORD DS:BX+56H],081CDH
		MOV [WORD DS:BX+5BH],0F0CDH
		
		MOV [WORD DS:BX+6CH],020CH
		MOV [WORD DS:BX+7FH],020EH
		MOV [WORD DS:BX+84H],0204H
		MOV [WORD DS:BX+88H],0206H
		MOV [WORD CS:JMPFAR+02H],@CURSEG
		MOV [WORD CS:JMPFAR],OFFSET JUMPEDDATA2
		MOV SI,00BDH
		ADD SI,BX
		
		MOV DI,OFFSET JUMPEDDATA2+02H
		
		PUSHF
		PUSH DS
		PUSH ES
		PUSH CS
		POP ES
		MOV CX,0006H
		CLD
		REP MOVSB

		MOV CX,0005H
		MOV SI,OFFSET JMPINST
		MOV DI,00BCH
		ADD DI,BX
		PUSH DS
		POP ES
		PUSH CS
		POP DS
		CLD
		REP MOVSB
		
		
		POP ES
		POP DS
		POPF
		JMP COMMON
JMPINST:
		DB 0EAH
JMPFAR:
		DB 00,00,00,00
JUMPEDDATA2:                
		DB 0CDH,83H,0,0,0,0,0,0
CHECKSCRE2B:
		PUSH CS
		POP ES
		MOV SI,0100H
		MOV DI,OFFSET SCRE2B102A
		MOV CX,000AH
		CLD
		REP CMPSB
		JNE CHECKEXE
		
		MOV DX,DS
		ADD DX,[WORD DS:010CH]
		MOV DS,DX
		XOR SI,SI
		MOV DI,OFFSET SCRE2B102B
		MOV CX,050
		CLD
		REP CMPSB
		JNE CHECKEXE

		MOV SI,003CH
		MOV DI,OFFSET SCRE2B102C
		MOV CX,0015
		CLD
		REP CMPSB
		JNE CHECKEXE

		MOV SI,0070H
		MOV DI,OFFSET SCRE2B102D
		MOV CX,0027
		CLD
		REP CMPSB
		JNE CHECKEXE
		
		PUSH DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET SCRE2B102OK
		CALL PRINT
		CALL PAGK

		MOV [BYTE CS:SCRE2B],01H
		CALL GETATTRIB
		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BREAKSCR0
		INT 21H
		POP DS
		
		MOV [WORD CS:TEMPBYTE],DS
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID],BX
		MOV AX,DS
		SUB AX,BX
		SUB AX,0010H
		MOV [WORD CS:SIZEEXE1],AX
		MOV [WORD DS:0011H],0F0CDH
		
		PUSH DS
		PUSH CS
		POP DS

		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET LINEPARAMETERS
		INT 21H

		POP DS
		
		MOV AX,[WORD CS:DTA+001AH]
		MOV CX,AX
		MOV BX,0010H
		XOR DX,DX
		DIV BX
		XOR DX,DX
		MUL BX
		SUB CX,AX
		DIV BX
		CMP CX,0000
		JE ENTERO
		INC AX
ENTERO:
		MOV CX,[WORD DS:0032H]
		CMP CX,0FFFFH
		JE PUTALLMEM
		SUB CX,AX
		SUB CX,0010H
PUTALLMEM:                
		MOV [WORD CS:EXEHEAD+000CH],CX
		MOV CX,[WORD DS:003AH]
		SUB CX,AX
		SUB CX,0010H
		MOV [WORD CS:EXEHEAD+000AH],CX
		
STARTSCRE2B:
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		MOV AX,[WORD CS:PID]
		MOV DS,AX
		MOV ES,AX
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]

BREAKSCR0:
		PUSHF
		PUSH AX
		CALL PUSHTEMP
		POP AX

		MOV [WORD CS:EXEHEAD+0006H],AX
		MOV [WORD CS:EXEHEAD+0017H],1C00H
		MOV [WORD CS:CANTRELOC],AX
		PUSH CS
		POP DS
		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		CMP [WORD CS:CANTRELOC],0001H
		JB NOHAYRELOCA
		MOV CX,001CH
		JMP SAVEHEADER
NOHAYRELOCA:
		MOV CX,0020H
SAVEHEADER:
		PUSH CS
		POP DS
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV DX,OFFSET EXEHEAD
		INT 21H
				
		MOV AX,[WORD CS:CANTRELOC]
		MOV BX,0004H
		MUL BX
		MOV CX,AX

		MOV DS,[WORD CS:TEMPBYTE]
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV DX,SI
		INT 21H

FIXFUCKINGHEAD:
		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		
		PUSH CS
		POP DS

		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H

		MOV ES,[WORD CS:PID]
		
		MOV AX,[WORD ES:009AH]
		MOV BX,0010H
		CWD
		DIV BX
		MUL BX
		ADD AX,0010H
		SUB AX,[WORD ES:009AH]
		PUSH AX

		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H

		POP CX
		CMP CX,0010H
		JNE FOLLOWSCRE2B
		XOR CX,CX
FOLLOWSCRE2B:
		MOV DX,OFFSET HEADFILL
		CALL WRITEEXE

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H

		PUSH CS
		POP DS
		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H
		
		MOV AH,2FH
		INT 21H
		
		MOV AX,[WORD ES:009AH]
		MOV BX,0010H
		CWD
		DIV BX
		MOV [WORD CS:EXEHEAD+0008H],AX
		
		MOV AX,[WORD CS:SIZEEXE1]
		MOV BX,0010H
		MUL BX
		MOV [WORD CS:HIGHSIZE],DX
		MOV [WORD CS:LOWSIZE],AX

		MOV DS,[WORD CS:TEMPBYTE]
		MOV [WORD DS:0086H],0F0CDH
		MOV AL,090H
		PUSH DS
		POP ES
		MOV DI,0015H
		MOV CX,0013
		CLD
		REP STOSB

		XOR AX,AX
		MOV ES,AX

		MOV [WORD ES:03C0H],OFFSET BREAKSCR1
		
		CALL POPTEMP
		POPF
		MOV CX,AX

		IRET
BREAKSCR1:
		POP AX
		POP AX
		POP AX
		MOV AX,25F0H
		LDS DX,[DWORD CS:INTF0IP]
		INT 21H; Last Break Point
		MOV DS,[WORD CS:TEMPBYTE]
		
		MOV AX,[WORD DS:008DH]
		MOV BX,[WORD DS:008FH]
		MOV [WORD CS:EXEHEAD+0010H],AX
		MOV [WORD CS:EXEHEAD+0014H],BX
		MOV AX,[WORD DS:0091H]
		MOV BX,[WORD DS:008BH]
		
		MOV CX,[WORD CS:PID]
		SUB AX,CX
		SUB AX,0010H
		SUB BX,CX
		SUB BX,0010H
		MOV [WORD CS:EXEHEAD+000EH],BX
		MOV [WORD CS:EXEHEAD+0016H],AX

		JMP SAVEMODULE
CHECKPRXCM3XCOM:
		PUSH CS
		POP ES
		MOV SI,[WORD CS:OFFSALTO]
		MOV DI,OFFSET PROTECT3XGEN
		MOV CX,0044
		CLD
		REP CMPSB
		JNZ CHECKPROTECT5COM
		MOV SI,[WORD CS:OFFSALTO]
		MOV AX,[WORD DS:SI+002CH]
		MOV SI,AX
		MOV AX,[WORD DS:SI+001CH]
		CMP AX,00FFH
		JZ PRXCM31COMOK
		CMP AX,0100H
		JZ PRXCM30COMOK
		JMP CHECKERROR
PRXCM31COMOK:
		PUSH DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM31COM
		CALL PRINT
		CALL PAGK
PRXCM3XGENERIC:                
		CALL GETATTRIB
		POP DS
		MOV BX,[WORD CS:OFFSALTO]
		MOV [WORD DS:BX+0FH],0204H                
		MOV [WORD DS:BX+14H],0206H                
		MOV [WORD DS:BX+19H],020CH                
		MOV [WORD DS:BX+1EH],020EH                
		MOV [WORD DS:BX+25H],0206H                
		MOV [WORD DS:BX+2AH],0204H                
		MOV [WORD DS:BX+30H],020EH                
		MOV [WORD DS:BX+35H],020CH                
		MOV [WORD DS:BX+3AH],81CDH
		PUSH DS
		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX31COM0
		INT 21H
		
		POP DS
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		MOV AX,DS
		MOV [WORD CS:DSEGMENT],AX
		MOV ES,AX
		XOR AX,AX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		MOV BX,[WORD CS:OFFSALTO]
		ADD BX,016BH
		MOV [WORD DS:BX],0F0CDH
		MOV [WORD DS:BX+02H],09090H
		MOV [WORD DS:BX+04H],09090H



		XOR BX,BX
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]

BRKPRX31COM0:
		PUSHF
		CALL PUSHTEMP
		
		MOV DS,[WORD CS:DSEGMENT]
		MOV BX,[WORD CS:OFFSALTO]
		MOV [BYTE DS:BX+0143H],0CFH
		MOV [WORD DS:BX+79H],0204H
		MOV [BYTE DS:BX+90H],090H
		MOV [WORD DS:BX+0BAH],081CDH
		MOV [WORD DS:BX+0D6H],020CH
		MOV [WORD DS:BX+0DEH],0204H
		MOV AX,[WORD DS:BX+097H]
		MOV [WORD CS:FILESIZECOM],AX
		MOV [WORD DS:BX+141H],0F0CDH

		MOV [WORD ES:03C0H],OFFSET BRKPRX31COM1
		
		CALL POPTEMP
		POPF
		IRET
BRKPRX31COM1:
		POP AX
		POP AX
		POP AX
		MOV AX,25F0H
		LDS DX,[DWORD CS:INTF0IP]
		INT 21H; Last Break Point
		JMP SAVEFUCK2
PRXCM30COMOK:
		PUSH DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM30COM
		CALL PRINT
		CALL PAGK
		JMP PRXCM3XGENERIC
CHECKPRXCM31EXE:
		MOV SI,[WORD CS:CHILDCSIP]
		MOV DI,OFFSET PRXCM31EXEID
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,88
		REP CMPSB
		JNZ CHECKPRXCM30EXE
		

		MOV [WORD CS:DSEGMENT],DS
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM31EXE
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]
		XOR BX,BX
		MOV [WORD DS:BX+4BH],0204H
		MOV [WORD DS:BX+55H],020CH
		MOV [WORD DS:BX+5CH],0204H
		MOV [WORD DS:BX+5FH],020CH
		MOV [WORD DS:BX+85H],081CDH
		
		MOV [WORD DS:BX+1FFH],0F0CDH
		MOV [WORD DS:BX+201H],9090H
		MOV [WORD DS:BX+203H],9090H




		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX31EXE0
		INT 21H

		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BRKPRX31EXE0:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV [BYTE DS:01D4H],0CFH
		MOV [WORD DS:00DDH],0204H
		MOV [BYTE DS:00ECH],090H
		MOV [WORD DS:012EH],081CDH
		MOV [BYTE DS:01B2H],090H
		MOV [BYTE DS:01B9H],090H
		MOV [WORD DS:01D1H],0F0CDH
		MOV AX,[WORD DS:0014H]
		MOV [WORD CS:SIZEEXE1],AX
		
		MOV [WORD ES:03C0H],OFFSET BRKPRX31EXE1
		
		
		CALL POPTEMP
		POPF

		IRET
BRKPRX31EXE1:
		JMP BRK55EXE
CHECKPRXCM30EXE:
		MOV SI,[WORD CS:CHILDCSIP]
		MOV DI,OFFSET PRXCM30EXEID
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,88
		REP CMPSB
		JNZ CHECKLZEXE091
		MOV [WORD CS:DSEGMENT],DS
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM30EXE
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]
		XOR BX,BX
		MOV [WORD DS:BX+4CH],0204H
		MOV [WORD DS:BX+54H],0206H
		MOV [WORD DS:BX+5CH],020CH
		MOV [WORD DS:BX+64H],020EH
		MOV [WORD DS:BX+70H],0206H
		MOV [WORD DS:BX+75H],0204H
		MOV [WORD DS:BX+7BH],020EH
		MOV [WORD DS:BX+80H],020CH
		MOV [WORD DS:BX+85H],081CDH
		
		MOV [WORD DS:BX+1FFH],0F0CDH
		MOV [WORD DS:BX+201H],9090H
		MOV [WORD DS:BX+203H],9090H




		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX30EXE0
		INT 21H

		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BRKPRX30EXE0:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV [BYTE DS:01D4H],0CFH
		MOV [WORD DS:00DDH],0204H
		MOV [BYTE DS:00ECH],090H
		MOV [WORD DS:012EH],081CDH
		MOV [BYTE DS:01B2H],090H
		MOV [BYTE DS:01B9H],090H
		MOV [WORD DS:01D1H],0F0CDH
		MOV AX,[WORD DS:0016H]
		MOV [WORD CS:SIZEEXE1],AX
		
		MOV [WORD ES:03C0H],OFFSET BRKPRX30EXE1
		
		
		CALL POPTEMP
		POPF

		IRET
BRKPRX30EXE1:
		JMP BRK55EXE
CHECKPRXCM20COM:
		PUSH CS
		POP ES
		MOV SI,0103H
		MOV DI,OFFSET PRXCM20COMID1
		MOV CX,0008H
		CLD
		REP CMPSB
		JZ SECONDCHECK
		JMP CHECKPRXCM1XCOM
SECONDCHECK:
		MOV SI,0150H
		MOV DI,OFFSET PRXCM20COMID2
		MOV CX,0018
		CLD
		REP CMPSB
		JZ CHECK20OK
		JMP CHECKERROR
CHECK20OK:
		MOV [WORD CS:DSEGMENT],DS
		MOV AX,[WORD DS:0101H]
		MOV [WORD CS:OFFSALTO],AX
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM20COM
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]
		MOV AX,[WORD DS:0178H]
		MOV [WORD CS:TEMPBYTE],AX
		MOV [WORD DS:0178H],0F0CDH

		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX20COM0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BRKPRX20COM0:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV AX,[WORD CS:TEMPBYTE]
		MOV [WORD DS:0178H],AX
		MOV BX,[WORD CS:OFFSALTO]
		MOV [WORD DS:BX+56H],0F0CDH
		MOV AX,[WORD DS:BX+0029H]
		MOV [WORD CS:FILESIZECOM],AX
		MOV BX,SP
		MOV [WORD SS:BX+0002H],0178H
		
		MOV [WORD ES:03C0H],OFFSET BRKPRX20COM1
		CALL POPTEMP
		POPF
		IRET
BRKPRX20COM1:
		POP AX
		JMP BRKPRX31COM1
CHECKPRXCM20EXE:
		MOV SI,00EAH
		MOV DI,OFFSET PRXCM20EXEID
		MOV CX,40
		CLD
		REP CMPSB
		JZ PRXCM20EXEOK
		JMP CHECKPRXCM11EXE
PRXCM20EXEOK:
		MOV [WORD CS:DSEGMENT],DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM20EXE
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]
		MOV [WORD DS:0132H],0F0CDH
		MOV [WORD DS:0134H],09090H
		MOV [WORD DS:0136H],09090H
		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX20EXE0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BRKPRX20EXE0:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV [BYTE DS:007FH],90H
		MOV [WORD DS:015CH],0F0CDH
		MOV AX,[WORD DS:00A7H]
		MOV [WORD CS:SIZEEXE1],AX
		MOV [WORD ES:03C0H],OFFSET BRKPRX20EXE1
		CALL POPTEMP
		POPF
		IRET
BRKPRX20EXE1:
		JMP BRK55EXE
CHECKPRXCM1XCOM:
		MOV SI,0103H
		MOV DI,OFFSET PRXCM1XCOMID1
		MOV CX,0004
		CLD
		REP CMPSB
		JZ NDCHECK
		JMP CHECKERROR
NDCHECK:
		MOV SI,[WORD DS:0101H]
		MOV DI,OFFSET PRXCM1XCOMID2
		MOV CX,0010H
		CLD
		REP CMPSB
		JZ PRXCM1XCOMOK
		JMP CHECKERROR
PRXCM1XCOMOK:
		MOV [WORD CS:DSEGMENT],DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM1XCOM
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB
		MOV DS,[WORD CS:DSEGMENT]

		MOV BX,[WORD DS:0101H]
		MOV [WORD CS:OFFSALTO],BX

		MOV [WORD DS:BX+003DH],0F0CDH

		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX1XCOM0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BRKPRX1XCOM0:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV BX,[WORD CS:OFFSALTO]
		MOV AX,[WORD DS:BX+0021H]
		MOV [WORD CS:FILESIZECOM],AX
		CALL POPTEMP
		POPF
		
		POP AX
		JMP BRKPRX31COM1
CHECKPRXCM11EXE:
		MOV SI,00CEH
		MOV DI,OFFSET PRXCM11EXEID
		MOV CX,40
		CLD
		REP CMPSB
		JZ PRXCM11EXEOK
		JMP CHECKPRXCM10EXE
PRXCM11EXEOK:
		MOV [WORD CS:DSEGMENT],DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM11EXE
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]
		
		MOV AX,[WORD DS:0107H]
		MOV [WORD CS:TEMPBYTE],AX
		MOV [WORD DS:0107H],0F0CDH
		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX11EXE0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BRKPRX11EXE0:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV [WORD DS:0129H],0F0CDH
		
		MOV AX,[WORD CS:TEMPBYTE]
		MOV [WORD DS:0107H],AX
		
		MOV AX,[WORD DS:008BH]
		MOV [WORD CS:SIZEEXE1],AX
		MOV [WORD ES:03C0H],OFFSET BRKPRX11EXE1
		MOV BX,SP
		MOV [WORD SS:BX+0002H],0107H
		CALL POPTEMP
		POPF
		IRET
BRKPRX11EXE1:
		JMP BRK55EXE
CHECKPRXCM10EXE:
		MOV SI,00CEH
		MOV DI,OFFSET PRXCM10EXEID
		MOV CX,43
		CLD
		REP CMPSB
		JZ PRXCM10EXEOK
		JMP CHECKERROR
PRXCM10EXEOK:
		MOV [WORD CS:DSEGMENT],DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PRXCM10EXE
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]
		
		MOV AX,[WORD DS:0107H]
		MOV [WORD CS:TEMPBYTE],AX
		MOV [WORD DS:0107H],0F0CDH
		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BRKPRX10EXE0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BRKPRX10EXE0:
		PUSHF
		CALL PUSHTEMP
		MOV DS,[WORD CS:DSEGMENT]
		MOV [WORD DS:0129H],0F0CDH
		
		MOV AX,[WORD CS:TEMPBYTE]
		MOV [WORD DS:0107H],AX
		
		MOV AX,[WORD DS:008BH]
		MOV [WORD CS:SIZEEXE1],AX
		MOV [WORD ES:03C0H],OFFSET BRKPRX10EXE1
		MOV BX,SP
		MOV [WORD SS:BX+0002H],0107H
		CALL POPTEMP
		POPF
		IRET
BRKPRX10EXE1:
		JMP BRK55EXE
CHECKLZEXE091:
		MOV SI,0136H
		MOV DI,OFFSET LZEXE091ID
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,34-9
		REP CMPSB
		JNZ CHECKLZEXE090

		CLC
		MOV [WORD CS:DSEGMENT],DS
		MOV [WORD DS:00FCH],0F0CDH
		MOV AX,[WORD DS:000AH]
		ADD [WORD CS:DSEGMENT],AX

		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET LZEXE091
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET LZEXE91BRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID],BX
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
LZEXE91BRK0:
		PUSHF
		MOV [WORD CS:PARAES],ES
		MOV [WORD CS:PARADI],DI
		CALL PUSHTEMP
		PUSH CS
		POP DS
		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		MOV [WORD CS:EXEHEADORIG+0018H],001CH
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,001CH
		MOV DX,OFFSET EXEHEADORIG
		INT 21H
		
		MOV DS,[WORD CS:DSEGMENT]
		
		MOV [WORD DS:0109H],0F0CDH
		MOV [WORD DS:010BH],09090H
		MOV [BYTE DS:010DH],90H
		MOV [WORD DS:011FH],0F0CDH
		MOV [BYTE DS:0121H],90H
		MOV [WORD ES:03C0H],OFFSET LZEXE91BRK1
		CALL POPTEMP
		MOV DS,[WORD CS:DSEGMENT]
		POPF
		IRET
LZEXE91BRK1:
		PUSHF
		CMP [BYTE CS:RELOCAPPLY],01H
		JZ SAVERELOC
		CALL PUSHTEMP
		LODSB
		OR AL,AL
		JZ CHECKAXEQUALONE
		
		MOV [BYTE CS:RELOCAPPLY],01H
		POP AX
		XOR AX,0040H
		PUSH AX
		CALL POPTEMP
		POPF
		LODSB
		IRET
CHECKAXEQUALONE:
		MOV BX,SP
		MOV [WORD SS:BX+0002H],0124H
		LODSW
		CMP AX,0001H
		JE NORMAL
		CMP AX,0000H
		JZ ITZERO
		MOV [BYTE CS:RELOCAPPLY],01H
ITZERO:
		POP AX
		XOR AX,0040H
		PUSH AX
		INC [WORD CS:TEMPSI]
		CALL POPTEMP
		POPF
		IRET
NORMAL:
		MOV [WORD DS:0150H],0F0CDH
		MOV [WORD ES:03C0H],OFFSET LZEXE091ENDBRK
		INC [WORD CS:TEMPSI]
		CALL POPTEMP
		POPF
		IRET




SAVERELOC:
		CALL PUSHTEMP
		MOV AX,[WORD CS:TEMPES]
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		MOV ES,AX
		MOV [WORD CS:DATAES],ES
		MOV [WORD CS:DATADI],DI
		PUSH CS
		POP DS
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0002H
		MOV DX,OFFSET DATADI
		INT 21H
		PUSH CS
		POP DS
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0002H
		MOV DX,OFFSET DATAES
		INT 21H
		MOV [BYTE CS:RELOCAPPLY],00H
		INC [WORD CS:CANTRELOC]
		CALL POPTEMP
		POPF
		IRET
LZEXE091ENDBRK:
		POP AX
		POP AX
		POP AX

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H

		MOV AX,[WORD CS:CANTRELOC]
		MOV [WORD CS:EXEHEADORIG+0006],AX
		MOV DS,[WORD CS:DSEGMENT]
		MOV AX,[WORD DS:0000H]
		MOV [WORD CS:EXEHEADORIG+0014H],AX
		MOV AX,[WORD DS:0002H]
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		CLC
		MOV [WORD CS:EXEHEADORIG+0016H],AX
		MOV [WORD CS:EXEHEADORIG+0010H],DI
		MOV AX,SI
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		MOV [WORD CS:EXEHEADORIG+000EH],AX
SAVECOMMON:                
		CALL FIXHEADLENGTH

		MOV AX,3D02H
		PUSH CS
		POP DS
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H

		MOV AX,[WORD CS:PID]
		ADD AX,0010H
		MOV DS,AX
WRITEONCEAGAIN:                
		MOV AX,[WORD CS:PARAES]
		MOV BX,DS
		CMP AX,BX
		JE WRITETHEBLOCK

		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0010H
		XOR DX,DX
		INT 21H

		MOV AX,DS
		INC AX
		MOV DS,AX
		JMP WRITEONCEAGAIN
WRITETHEBLOCK:
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,[WORD CS:PARADI]
		XOR DX,DX
		INT 21H

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H

		CMP [BYTE CS:FAKEPK],01H
		JNE CONTSAVING
		CALL FAKEPKLITE
CONTSAVING:
		CALL SETRESERVEDMEM
		
		PUSH CS
		POP DS
		PUSH CS
		POP ES
		MOV SI,OFFSET EXEHEADORIG
		MOV DI,OFFSET EXEHEAD
		MOV CX,001CH
		CLD
		REP MOVSB

		JMP SETSIZE
















CHECKLZEXE090:
		MOV SI,[WORD CS:CHILDCSIP]
		MOV DI,OFFSET LZEXE090ID
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,47
		REP CMPSB
		JNZ CHECKSCRE2B
		MOV [WORD CS:DSEGMENT],DS
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET LZEXE090
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		CLC
		MOV DS,[WORD CS:DSEGMENT]
		MOV [BYTE DS:003FH],0EBH
		MOV [WORD DS:0130H],0F0CDH
		MOV AX,[WORD DS:000AH]
		ADD [WORD CS:DSEGMENT],AX

		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET LZEXE90BRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID],BX
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
LZEXE90BRK0:
		PUSHF
		MOV [WORD CS:PARAES],ES
		MOV [WORD CS:PARADI],DI
		CALL PUSHTEMP
		PUSH CS
		POP DS
		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		MOV [WORD CS:EXEHEADORIG+0018H],001CH
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,001CH
		MOV DX,OFFSET EXEHEADORIG
		INT 21H
		
		MOV DS,[WORD CS:DSEGMENT]
		
		MOV [WORD DS:014EH],0F0CDH
		MOV [BYTE DS:0150H],90H
		MOV [BYTE DS:0189H],042H
		MOV [WORD DS:018BH],0F0CDH
		MOV [WORD ES:03C0H],OFFSET LZEXE90BRK1
		CALL POPTEMP
		MOV DS,[WORD CS:DSEGMENT]
		POPF
		IRET
LZEXE90BRK1:
		PUSHF
		CALL PUSHTEMP
		CMP DX,0F001H
		JE ENDBRKLZ09

		CALL SAVERELOC2
		
		CALL POPTEMP
		POPF
		IRET
ENDBRKLZ09:
		MOV [WORD CS:TEMPSI],SI
		MOV [WORD CS:TEMPDI],DI
		CALL POPTEMP
		POPF
		JMP LZEXE091ENDBRK
		
		IRET
SAVERELOC2:
		MOV AX,[WORD CS:TEMPES]
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		MOV ES,AX
		MOV [WORD CS:DATAES],ES
		MOV [WORD CS:DATADI],DI
		PUSH CS
		POP DS
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0002H
		MOV DX,OFFSET DATADI
		INT 21H
		PUSH CS
		POP DS
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,0002H
		MOV DX,OFFSET DATAES
		INT 21H
		INC [WORD CS:CANTRELOC]
		RET

FIXHEADLENGTH:
		PUSH CS
		POP DS
		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV AH,2FH
		INT 21H
		
		MOV AX,[WORD ES:009AH]
		MOV BX,0010H
		CWD
		DIV BX
		MUL BX
		ADD AX,0010H
		SUB AX,[WORD ES:009AH]
		PUSH AX

		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H

		POP CX
		CMP CX,0010H
		JNE WRITEFILL
		XOR CX,CX
WRITEFILL:
		MOV DX,OFFSET HEADFILL
		CALL WRITEEXE

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		
		PUSH CS
		POP DS
		MOV AH,4EH
		MOV CX,00FFH
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV AH,2FH
		INT 21H
		
		MOV AX,[WORD ES:009AH]
		MOV BX,0010H
		CWD
		DIV BX
		MOV [WORD CS:EXEHEADORIG+0008H],AX

		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		
		MOV [WORD CS:HANDLE],AX

		MOV CX,001CH
		MOV DX,OFFSET EXEHEADORIG
		CALL WRITEEXE

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H

		RET
CHECKCRUNCH11:
		MOV SI,[WORD CS:OFFSALTO]
		MOV DI,OFFSET CRUNCH11ID1
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,4
		REP CMPSB
		JNZ CHECKCRUNCH12
		
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0008H
		MOV DI,OFFSET CRUNCH11ID2
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,10
		REP CMPSB
		JNZ CHECKCRUNCH12
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0020
		MOV DI,OFFSET CRUNCH11ID3
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,4
		REP CMPSB
		JNZ CHECKCRUNCH12
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0025
		MOV DI,OFFSET CRUNCH11ID4
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,5
		REP CMPSB
		JNZ CHECKCRUNCH12
		
		MOV [WORD CS:DSEGMENT],DS
		
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET CRUNCH11
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]

		MOV BX,[WORD CS:OFFSALTO]
		
		MOV [WORD DS:BX+0019H],0F0CDH
	       
		MOV AX,[WORD DS:BX+0006]
		ADD AX,0003

		MOV [WORD CS:FILESIZECOM],AX

		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET CRUNCH11BRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
CRUNCH11BRK0:
		JMP BRKPRX31COM1
CHECKCRUNCH12:
		MOV SI,[WORD CS:OFFSALTO]
		MOV DI,OFFSET CRUNCH12ID1
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,10
		REP CMPSB
		JNZ CHECKCRUNCH13

		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0013
		MOV DI,OFFSET CRUNCH12ID2
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,4
		REP CMPSB
		JNZ CHECKCRUNCH13
		
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0008+13
		MOV DI,OFFSET CRUNCH12ID3
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,10
		REP CMPSB
		JNZ CHECKCRUNCH13
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0020+13
		MOV DI,OFFSET CRUNCH12ID4
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,4
		REP CMPSB
		JNZ CHECKCRUNCH13
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0025+13
		MOV DI,OFFSET CRUNCH12ID5
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,5
		REP CMPSB
		JNZ CHECKCRUNCH13
		
		MOV [WORD CS:DSEGMENT],DS
		
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET CRUNCH12
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]

		MOV BX,[WORD CS:OFFSALTO]
		
		MOV [WORD DS:BX+0029H],0F0CDH
	       
		MOV AX,[WORD DS:BX+0019]
		ADD AX,0003

		MOV [WORD CS:FILESIZECOM],AX

		PUSH DS
		POP ES

		MOV DI,BX

		MOV AL,090H
		MOV CX,0013
		CLD
		REP STOSB


		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET CRUNCH12BRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
CRUNCH12BRK0:
		JMP BRKPRX31COM1
CHECKCRUNCH13:
		MOV SI,[WORD CS:OFFSALTO]
		MOV DI,OFFSET CRUNCH13ID1
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,10
		REP CMPSB
		JNZ CHECKPRXCM3XCOM

		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0013
		MOV DI,OFFSET CRUNCH13ID2
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,4
		REP CMPSB
		JNZ CHECKPRXCM3XCOM
		
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0022
		MOV DI,OFFSET CRUNCH13ID3
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,12
		REP CMPSB
		JNZ CHECKPRXCM3XCOM
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0036
		MOV DI,OFFSET CRUNCH13ID4
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,4
		REP CMPSB
		JNZ CHECKPRXCM3XCOM
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0041
		MOV DI,OFFSET CRUNCH13ID5
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,5
		REP CMPSB
		JNZ CHECKPRXCM3XCOM
		
		MOV [WORD CS:DSEGMENT],DS
		
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET CRUNCH13
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]

		MOV BX,[WORD CS:OFFSALTO]
		
		MOV [WORD DS:BX+0044],0F0CDH
	       
		MOV AX,[WORD DS:BX+0020]
		ADD AX,0003

		MOV [WORD CS:FILESIZECOM],AX

		PUSH DS
		POP ES

		MOV DI,BX
		ADD DI,0003


		MOV AL,090H
		MOV CX,0010
		CLD
		REP STOSB


		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET CRUNCH13BRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
CRUNCH13BRK0:
		JMP BRKPRX31COM1
CHECKBLIZT10B:
		MOV SI,[WORD CS:OFFSALTO]
		MOV DI,OFFSET BLIZTID1
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,14
		REP CMPSB
		JNZ CHECKCRUNCH11
		
		MOV SI,[WORD CS:OFFSALTO]
		ADD SI,0016
		MOV DI,OFFSET BLIZTID2
		MOV DS,[WORD CS:CHILDCSIP+02]
		PUSH CS
		POP ES
		CLD
		MOV CX,19
		REP CMPSB
		JNZ CHECKCRUNCH11
		MOV [WORD CS:DSEGMENT],DS
		
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET BLIZT10B
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]

		MOV BX,[WORD CS:OFFSALTO]
		
		MOV [WORD DS:BX+0045],0F0CDH
	       
		MOV AX,[WORD DS:BX+0014]
		ADD AX,0003

		MOV [WORD CS:FILESIZECOM],AX

		
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET BLIZTBRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
BLIZTBRK0:
		JMP BRKPRX31COM1
CHECKPKLITE115COM:                
		PUSH CS
		POP ES
		MOV SI,0106H
		MOV DI,OFFSET PKLITE115COMID
		MOV CX,0040
		CLD
		REP CMPSB
		JNZ CHECKPKLITE115EXE
		MOV [WORD CS:DSEGMENT],DS
		
		
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE115COM
		CALL PRINT
		CALL PAGK
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]

		
		MOV [WORD DS:0297H],0F0CDH
	       
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET PKLITE115COMBRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
PKLITE115COMBRK0:
		SUB DI,0100H
		MOV [WORD CS:FILESIZECOM],DI
		JMP BRKPRX31COM1
CHECKPKLITE115EXE:                
		PUSH CS
		POP ES
		MOV SI,012AH
		MOV DI,OFFSET PKLITE115EXEID1
		MOV CX,0006
		CLD
		REP CMPSB
		JNZ CHECKPKLITE115EXTRA

		
		PUSH CS
		POP ES
		MOV SI,0132H
		MOV DI,OFFSET PKLITE115EXEID2
		MOV CX,0005
		CLD
		REP CMPSB
		JNZ CHECKPKLITE115EXTRA
		
		PUSH CS
		POP ES
		MOV SI,0139H
		MOV DI,OFFSET PKLITE115EXEID3
		MOV CX,0010
		CLD
		REP CMPSB
		JNZ CHECKPKLITE115EXTRA
		
		MOV [WORD CS:DSEGMENT],DS

		MOV AX,[WORD DS:0130H]
		CMP AX,0025H
		JNZ SHORTMETHOD ; mtodo corto
		MOV [BYTE CS:PKLITESHORTLONG],01H ; pone mtodo largo

		
SHORTMETHOD:                
		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE115EXE
		CALL PRINT
		CALL PAGK
		
		CALL GETATTRIB

		MOV DS,[WORD CS:DSEGMENT]
		CMP [BYTE CS:PKLITESHORTLONG],01H
		JZ BREAKLONG
		MOV [WORD DS:0267H],0F0CDH
		JMP COMMONJUMP
BREAKLONG:
		MOV [WORD DS:0310H],0F0CDH

COMMONJUMP:
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET PKLITE115EXEBRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID],BX

		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
PKLITE115EXEBRK0:
		PUSHF
		CALL PUSHTEMP
		MOV DX,[WORD CS:TEMPES]
		MOV AX,[WORD CS:TEMPDI]
		
		CMP DX,[WORD CS:PID]
		JNE ALLPARANORMAL
		ADD DX,0010H
		SUB AX,0100H

ALLPARANORMAL:
		MOV [WORD CS:PARAES],DX
		MOV [WORD CS:PARADI],AX
		
		PUSH CS
		POP DS
		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		MOV [WORD CS:EXEHEADORIG+0018H],001CH
		
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,001CH
		MOV DX,OFFSET EXEHEADORIG
		INT 21H

		MOV [WORD ES:03C0H],OFFSET PKLITE115EXEBRK1
		
		CMP [BYTE CS:PKLITESHORTLONG],01H
		JZ PUTBRKLONG

		MOV BX,SP
		
		MOV DS,[WORD SS:BX+0004H]

		MOV [WORD DS:0136H],0F0CDH
		MOV [BYTE DS:0138H],090H
		MOV [WORD DS:013EH],0D1F7H
		MOV [WORD DS:0140H],0F0CDH
		MOV [WORD DS:0143H],0F0CDH
		MOV [WORD DS:0145H],09090H
		MOV [WORD DS:015EH],0F0CDH


		JMP ALLNORMAL
PUTBRKLONG:
		MOV BX,SP
		
		MOV DS,[WORD SS:BX+0004H]

		MOV [WORD DS:01DEH],0F0CDH
		MOV [BYTE DS:01E0H],090H
		MOV [WORD DS:01E6H],0D1F7H
		MOV [WORD DS:01E8H],0F0CDH
		MOV [WORD DS:01EBH],0F0CDH
		MOV [WORD DS:01EDH],09090H
		MOV [WORD DS:0206H],0F0CDH


ALLNORMAL:
		
		
		CALL POPTEMP
		MOV BP,BX
		POPF
		IRET 

PKLITE115EXEBRK1:
		PUSHF
		CALL PUSHTEMP
		CMP CX,0FFFFH
		JE NOMASRELOC

		CALL SAVERELOC2

		CALL POPTEMP
		POPF
		IRET
NOMASRELOC:
		MOV [WORD ES:03C0H],OFFSET PKLITE115EXEBRK2
		
		MOV [WORD CS:TEMPCX],0000
		CALL POPTEMP                
		ADD AX,BX
		XCHG AX,DX
		LODSW
		POPF
		IRET

		


PKLITE115EXEBRK2:
		PUSHF
		CALL PUSHTEMP
		MOV AX,[WORD CS:TEMPAX]
		MOV DX,[WORD CS:TEMPDX]
		SUB DX,[WORD CS:PID]
		SUB DX,0010H
		MOV [WORD CS:EXEHEADORIG+0EH],DX
		MOV [WORD CS:EXEHEADORIG+10H],AX
		MOV [WORD ES:03C0H],OFFSET PKLITE115EXEBRK3
		CALL POPTEMP
		POPF
		IRET
PKLITE115EXEBRK3:
		POP AX
		POP AX
		POP AX
		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		
		POP AX
		MOV [WORD CS:EXEHEADORIG+14H],AX
		POP AX
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		MOV [WORD CS:EXEHEADORIG+16H],AX
		MOV AX,[WORD CS:CANTRELOC]
		MOV [WORD EXEHEADORIG+06H],AX
		
		JMP SAVECOMMON

SETRESERVEDMEM:
		MOV DX,[WORD CS:PID]
		ADD DX,0010H
		CMP DX,[WORD CS:PARAES]
		JNE ALLNORMALOK
		SUB [WORD CS:PARAES],0010H
		ADD [WORD CS:PARADI],0100H
ALLNORMALOK:
		MOV AX,[WORD CS:PARAES]
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		MOV CL,04
		ROL AX,CL
		MOV DX,AX
		AND AX,0FFF0H
		ADD AX,[WORD CS:PARADI]
		ADC DX,0
		AND DX,0FH
		MOV [WORD CS:MSBLENGTH],DX
		MOV [WORD CS:LSBLENGTH],AX
		
		MOV DX,[WORD CS:EXEHEADORIG+0EH]
		MOV AX,[WORD CS:EXEHEADORIG+10H]
		MOV CL,04H
		ROL DX,CL
		MOV CX,DX
		AND DX,0FH
		AND CX,-10H
		ADD AX,CX
		ADC DX,0
		SUB AX,[WORD CS:LSBLENGTH]
		SBB DX,[WORD CS:MSBLENGTH]
		JB TANTO
		XOR DX,DX
		MOV CX,0010H
		DIV CX
		DEC DX
		CMP DX,CX
		ADC AX,0000
		MOV [WORD CS:EXEHEADORIG+0AH],AX
YEAAAH:                
		MOV [WORD CS:EXEHEADORIG+0CH],0FFFFH
		RET
TANTO:
		MOV [WORD CS:EXEHEADORIG+0AH],0000H
		JMP YEAAAH
CHECKPKLITE115EXTRA:                
		PUSH CS
		POP ES
		MOV SI,012AH
		MOV DI,OFFSET PKLITE115XTRAID1
		MOV CX,0030
		CLD
		REP CMPSB
		JNZ CHECKPKLITE115EXTRA2
		MOV [BYTE CS:PKTYPE],01H
		MOV [WORD CS:DSEGMENT],DS

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE115XTRA
		CALL PRINT
		CALL PAGK
PKXTRACOMMON:                
		CALL GETATTRIB
		MOV DS,[WORD CS:DSEGMENT]
		CMP [BYTE CS:PKTYPE],05H
		JE XTRA120
		CMP [BYTE CS:PKTYPE],06H
		JE XTRA120
		CMP [BYTE CS:PKTYPE],07H
		JE XTRA1202
		MOV [WORD DS:0143H],0F0CDH
		JMP NOMOREPKTYPES                
XTRA120:
		MOV [WORD DS:0141H],0F0CDH
		JMP NOMOREPKTYPES
XTRA1202:
		MOV [WORD DS:014BH],0F0CDH

NOMOREPKTYPES:
		PUSH CS
		POP ES
		
		XOR AX,AX
		MOV DS,AX
		MOV SI,0
		MOV DI,OFFSET BACKUPINT
		MOV CX,4*0100H
		CLD
		REP MOVSB
		PUSH CS
		POP DS
		MOV AX,35F0H
		INT 21H
		MOV [WORD PTR CS:INTF0IP],BX
		MOV [WORD PTR CS:INTF0CS],ES
		MOV AX,25F0H
		MOV DX,OFFSET PKLITE115XTRABRK0
		INT 21H
		MOV AH,62H
		INT 21H
		MOV [WORD CS:PID],BX

		MOV ES,BX
		MOV DS,BX
		
		MOV [WORD CS:INITSSSP],SS
		MOV [WORD CS:INITSSSP+02H],SP
		MOV SS,[WORD CS:CHILDSSSP+02H]
		MOV SP,[WORD CS:CHILDSSSP]
		XOR AX,AX
		XOR BX,BX
		XOR CX,CX
		XOR DX,DX
		XOR SI,SI
		XOR DI,DI
		
		PUSH AX
		POPF
		STI
		JMP [DWORD CS:CHILDCSIP]
PKLITE115XTRABRK0:
		PUSHF
		CALL PUSHTEMP
		
		CALL POPTEMP
		CMP CX,0001
		JE LASTDECRYPT
		CMP [BYTE CS:PKTYPE],05
		JZ PUTADD120
		CMP [BYTE CS:PKTYPE],06
		JZ PUTADD120
		CMP [BYTE CS:PKTYPE],07H
		JZ PUTADD120
		XOR AX,DX
		POPF
		IRET
PUTADD120:
		ADD AX,DX
		POPF
		IRET
LASTDECRYPT:
		XOR AX,AX
		MOV ES,AX
		MOV [WORD ES:03C0H],OFFSET PKLITE115XTRABRK1
		CMP [BYTE CS:PKTYPE],02
		JZ PK1152BRK
		CMP [BYTE CS:PKTYPE],03
		JZ PK1141BRK
		CMP [BYTE CS:PKTYPE],04
		JZ PK1142BRK
		CMP [BYTE CS:PKTYPE],05
		JZ ALLPK120BRK
		CMP [BYTE CS:PKTYPE],06
		JZ ALLPK120BRK
		CMP [BYTE CS:PKTYPE],07
		JZ ALLPK120BRK2

		MOV [WORD DS:0286H],0F0CDH
		MOV [WORD DS:029AH],0F0CDH
		MOV [BYTE DS:029CH],090H
		MOV [WORD DS:02A6H],0D1F7H
		MOV [WORD DS:02A8H],0F0CDH
		MOV [WORD DS:02ABH],0F0CDH
		MOV [WORD DS:02ADH],09090H
		MOV [WORD DS:02CCH],0F0CDH
		JMP BRKXTRACOMMON
PK1152BRK:
		MOV [WORD DS:032DH],0F0CDH
		MOV [WORD DS:0340H],0F0CDH
		MOV [BYTE DS:0342H],090H
		MOV [WORD DS:034CH],0D1F7H
		MOV [WORD DS:034EH],0F0CDH
		MOV [WORD DS:0351H],0F0CDH
		MOV [WORD DS:0353H],09090H
		MOV [WORD DS:0372H],0F0CDH
		JMP BRKXTRACOMMON
PK1141BRK:
		MOV [WORD DS:0284H],0F0CDH
		MOV [WORD DS:0298H],0F0CDH
		MOV [BYTE DS:029AH],090H
		MOV [WORD DS:02A4H],0D1F7H
		MOV [WORD DS:02A6H],0F0CDH
		MOV [WORD DS:02A9H],0F0CDH
		MOV [WORD DS:02ABH],09090H
		MOV [WORD DS:02CAH],0F0CDH
		JMP BRKXTRACOMMON
PK1142BRK:
		MOV [WORD DS:032DH],0F0CDH
		MOV [WORD DS:0340H],0F0CDH
		MOV [BYTE DS:0342H],090H
		MOV [WORD DS:034CH],0D1F7H
		MOV [WORD DS:034EH],0F0CDH
		MOV [WORD DS:0351H],0F0CDH
		MOV [WORD DS:0353H],09090H
		MOV [WORD DS:0372H],0F0CDH
		JMP BRKXTRACOMMON
ALLPK120BRK:
		MOV [WORD DS:025CH],0F0CDH
		MOV [WORD DS:026CH],0F0CDH
		MOV [BYTE DS:026EH],090H
		
		MOV [WORD DS:0278H],0D1F7H
		MOV [WORD DS:027AH],0F0CDH

		MOV [WORD DS:027CH],09090H
		MOV [WORD DS:027EH],0F0CDH
		MOV [WORD DS:0280H],09090H
		
		MOV [WORD DS:029AH],0F0CDH
		JMP BRKXTRACOMMON
ALLPK120BRK2:
		MOV [WORD DS:0328H],0F0CDH
		MOV [WORD DS:033EH],0F0CDH
		MOV [BYTE DS:0340H],090H
		
		MOV [WORD DS:0349H],0D1F7H
		MOV [WORD DS:034BH],0F0CDH

		MOV [WORD DS:034DH],09090H
		MOV [WORD DS:034FH],0F0CDH
		MOV [WORD DS:0351H],09090H
		
		MOV [WORD DS:036FH],0F0CDH
		JMP BRKXTRACOMMON

BRKXTRACOMMON:
		MOV AX,[WORD CS:TEMPAX]
		MOV DX,[WORD CS:TEMPDX]
		MOV ES,[WORD CS:TEMPES]
		
		CMP [BYTE CS:PKTYPE],05
		JZ PUT1ADD120
		CMP [BYTE CS:PKTYPE],06
		JZ PUT1ADD120
		CMP [BYTE CS:PKTYPE],07
		JZ PUT1ADD120
		XOR AX,DX
		POPF
		IRET
PUT1ADD120:
		ADD AX,DX
		POPF
		IRET

PKLITE115XTRABRK1:
		PUSHF                
		CALL PUSHTEMP
		
		MOV DX,[WORD CS:TEMPES]
		MOV AX,[WORD CS:TEMPDI]
		
		CMP DX,[WORD CS:PID]
		JNE ALLPARANORMAL1
		ADD DX,0010H
		SUB AX,0100H

ALLPARANORMAL1:
		MOV [WORD CS:PARAES],DX
		MOV [WORD CS:PARADI],AX
		
		PUSH CS
		POP DS
		MOV AX,3D02H
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX
		MOV [WORD CS:EXEHEADORIG+0018H],001CH
		
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		MOV CX,001CH
		MOV DX,OFFSET EXEHEADORIG
		INT 21H

		MOV [WORD ES:03C0H],OFFSET PKLITE115XTRABRK2
		
		CALL POPTEMP
		CMP [BYTE CS:PKTYPE],05
		JE PUT2BRK120
		CMP [BYTE CS:PKTYPE],06
		JE PUT2BRK120
		MOV BP,BX
		POPF
		IRET 
PUT2BRK120:
		MOV DX,BX
		POPF
		IRET

PKLITE115XTRABRK2:
		
		PUSHF
		CALL PUSHTEMP
		CMP CX,0FFFFH
		JE NOMASRELOC2

		CALL SAVERELOC2

		CALL POPTEMP
		POPF
		IRET
NOMASRELOC2:
		MOV [WORD ES:03C0H],OFFSET PKLITE115XTRABRK3
		
		MOV [WORD CS:TEMPCX],0000
		CALL POPTEMP                
		CMP [BYTE CS:PKTYPE],05
		JZ ALL120BRK2
		CMP [BYTE CS:PKTYPE],06
		JZ ALL120BRK2
		CMP [BYTE CS:PKTYPE],07
		JZ ALL120BRK2
		ADD AX,BX
		XCHG AX,DX
		LODSW
		POPF
		IRET
ALL120BRK2:
		LODSW
		ADD AX,BX
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		MOV [WORD CS:EXEHEADORIG+0EH],AX
		LODSW
		MOV [WORD CS:EXEHEADORIG+10H],AX
		POPF
		IRET


		
PKLITE115XTRABRK3:                
		PUSHF
		CALL PUSHTEMP
		CMP [BYTE CS:PKTYPE],05
		JZ ANTEULTIMOBRK
		CMP [BYTE CS:PKTYPE],06
		JZ ANTEULTIMOBRK
		CMP [BYTE CS:PKTYPE],07
		JZ ANTEULTIMOBRK

		MOV AX,[WORD CS:TEMPAX]
		MOV DX,[WORD CS:TEMPDX]
		SUB DX,[WORD CS:PID]
		SUB DX,0010H
		MOV [WORD CS:EXEHEADORIG+0EH],DX
		MOV [WORD CS:EXEHEADORIG+10H],AX

ANTEULTIMOBRK:                
		MOV [WORD ES:03C0H],OFFSET PKLITE115XTRABRK4
		CALL POPTEMP
		POPF
		IRET
PKLITE115XTRABRK4:
		POP AX
		POP AX
		POP AX
		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H
		
		POP AX
		MOV [WORD CS:EXEHEADORIG+14H],AX
		POP AX
		SUB AX,[WORD CS:PID]
		SUB AX,0010H
		MOV [WORD CS:EXEHEADORIG+16H],AX
		MOV AX,[WORD CS:CANTRELOC]
		MOV [WORD EXEHEADORIG+06H],AX
		MOV [BYTE CS:FAKEPK],01H

		JMP SAVECOMMON
FAKEPKLITE:
		MOV DX,OFFSET FAKEXTR141520
		CALL PRINT
		
PAGK3:           ; Press And Get Key 3 :)
		
GETKEY3:
		MOV AH,08H
		INT 21H
		CMP AL,79H
		JE LETCONT3
		CMP AL,59H
		JE LETCONT3
		CMP AL,4EH
		JE DONTCONT3
		CMP AL,6EH
		JE DONTCONT3
		JMP GETKEY3
DONTCONT3:                

		CALL PRINTCHAR
		RETN
LETCONT3:
		CALL PRINTCHAR
		
		MOV AX,[WORD CS:EXEHEADORIG+14H]
		MOV [WORD CS:FAKEPKUPPER+13],AX
		MOV [WORD CS:FAKEPKLOWER+13],AX
		MOV AX,[WORD CS:EXEHEADORIG+16H]
		ADD AX,0010H
		MOV [WORD CS:FAKEPKUPPER+09],AX
		MOV [WORD CS:FAKEPKLOWER+09],AX

		MOV AX,3D02H
		PUSH CS
		POP DS
		MOV DX,OFFSET TEMPPARAMETERS
		INT 21H
		MOV [WORD CS:HANDLE],AX

		MOV AX,4202H
		MOV BX,[WORD CS:HANDLE]
		XOR CX,CX
		XOR DX,DX
		INT 21H

		PUSH DX
		PUSH AX
		
		XOR DX,DX
		CLC
		MOV CX,0010h
		DIV CX
		
		CMP DX,0000
		JE NOSUMA
		INC AX
NOSUMA:
		CLC
		XOR DX,DX
		MUL CX
		POP DX
		POP DX
		ADC DX,0000

		PUSH DX
		PUSH AX

		CLC
		XOR DX,DX
		MOV AX,[WORD CS:EXEHEADORIG+08H]
		MOV BX,0010H
		MUL BX

		MOV CX,DX
		MOV BX,AX

		POP AX
		POP DX

		PUSH DX
		PUSH AX

		SUB AX,BX
		SBB DX,CX

		CLC
		MOV CX,0010h
		DIV CX
		MOV [WORD CS:EXEHEADORIG+14H],0000
		MOV [WORD CS:EXEHEADORIG+16H],AX 

		POP AX
		POP DX

		
		MOV CX,DX
		MOV DX,AX

		MOV AX,4200H
		MOV BX,[WORD CS:HANDLE]
		INT 21H

		CMP [BYTE CS:PKTYPE],05                
		JZ PUTFAKELOWER
		CMP [BYTE CS:PKTYPE],06                
		JZ PUTFAKELOWER
		CMP [BYTE CS:PKTYPE],07                
		JZ PUTFAKELOWER
		
		MOV DX,OFFSET FAKEPKUPPER
		JMP WRITEFAKE
PUTFAKELOWER:
		MOV DX,OFFSET FAKEPKLOWER
WRITEFAKE:
		MOV AH,40H
		MOV BX,[WORD CS:HANDLE]
		PUSH CS
		POP DS
		MOV CX,0017
		INT 21H

		MOV AH,3EH
		MOV BX,[WORD CS:HANDLE]
		INT 21H

		RET

CHECKPKLITE115EXTRA2:                
		PUSH CS
		POP ES
		MOV SI,012AH
		MOV DI,OFFSET PKLITE115XTRAID2
		MOV CX,0030
		CLD
		REP CMPSB
		JNZ CHECKPKLITE114EXTRA1
		
		MOV [WORD CS:DSEGMENT],DS
		MOV [BYTE CS:PKTYPE],02

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE115XTRA
		CALL PRINT
		CALL PAGK
		JMP PKXTRACOMMON

CHECKPKLITE114EXTRA1:                
		PUSH CS
		POP ES
		MOV SI,012AH
		MOV DI,OFFSET PKLITE114XTRAID1
		MOV CX,0030
		CLD
		REP CMPSB
		JNZ CHECKPKLITE114EXTRA2
		
		MOV [WORD CS:DSEGMENT],DS
		MOV [BYTE CS:PKTYPE],03

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE114XTRA
		CALL PRINT
		CALL PAGK
		JMP PKXTRACOMMON
CHECKPKLITE114EXTRA2:                
		PUSH CS
		POP ES
		MOV SI,012AH
		MOV DI,OFFSET PKLITE114XTRAID2
		MOV CX,0030
		CLD
		REP CMPSB
		JNZ CHECKPKLITE120EXTRA1
		
		MOV [WORD CS:DSEGMENT],DS
		MOV [BYTE CS:PKTYPE],04

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE114XTRA
		CALL PRINT
		CALL PAGK
		JMP PKXTRACOMMON
CHECKPKLITE120EXTRA1:                
		PUSH CS
		POP ES
		MOV SI,012AH
		MOV DI,OFFSET PKLITE120XTRAID1
		MOV CX,0028
		CLD
		REP CMPSB
		JNZ CHECKPKLITE120EXTRA2
		
		MOV [WORD CS:DSEGMENT],DS
		MOV [BYTE CS:PKTYPE],05

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE120XTRA
		CALL PRINT
		CALL PAGK
		JMP PKXTRACOMMON
CHECKPKLITE120EXTRA2:                
		PUSH CS
		POP ES
		MOV SI,012AH
		MOV DI,OFFSET PKLITE120XTRAID2
		MOV CX,0028
		CLD
		REP CMPSB
		JNZ CHECKPKLITE120EXTRA3
		
		MOV [WORD CS:DSEGMENT],DS
		MOV [BYTE CS:PKTYPE],06

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE120XTRA
		CALL PRINT
		CALL PAGK
		JMP PKXTRACOMMON
CHECKPKLITE120EXTRA3:                
		PUSH CS
		POP ES
		MOV SI,012CH
		MOV DI,OFFSET PKLITE120XTRAID3
		MOV CX,0036
		CLD
		REP CMPSB
		JNZ CHECKPRXCM20COM
		
		MOV [WORD CS:DSEGMENT],DS
		MOV [BYTE CS:PKTYPE],07

		MOV DX,OFFSET FOUNDPRG
		CALL PRINT
		MOV DX,OFFSET PKLITE120XTRA
		CALL PRINT
		CALL PAGK
		JMP PKXTRACOMMON

DESUBICATEDTEXT:
		DB 0DH,0AH
		DB 'This program is dedicated to those lammers which can not',0dh,0ah
		DB 'unprotect any program with their OWN HANDS',0dh,0ah
		DB 'If the protection system is safely it will be BROKEN...'
		DB '(MURPHY',039,'s Law)',0dh,0ah,'Don',039,'t you Jeremy Lilley? ...',0dh,0ah
		DB '---> Greetz to Phredi Jay,Billy,Jason,Luck,Kalop....',0dh,0ah
		DB '---> Special greetings goes to SmileSoft Company for their BIG HELP!!!',0dh,0ah
		DB '---> Fuckz to Darkness,Fedcon,KeyWiz,DK2',0dh,0ah
		DB '---> Christ is Lord and Savior, Praise the Lord...:)',0dh,0ah
		DB 'At this moment, I',039,'m looking 4 a girlfriend around my age :) (18)',0dh,0ah
		DB 'Daniel, you are the only one friend I have, please, help me'
		DB ' to find',0dh,0ah,'Viviana',039,'s friend :).',0dh,0ah,'Do you remember her NAME?'

SEGMENT         XT
ENDS            XT

END             MAIN


